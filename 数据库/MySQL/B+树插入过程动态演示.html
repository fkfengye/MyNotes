<svg width="1600" height="2000" xmlns="http://www.w3.org/2000/svg">
  <!-- 标题 -->
  <text x="800" y="50" text-anchor="middle" font-size="32" font-weight="bold" fill="#333">B+树插入过程动态演示</text>
  <text x="800" y="85" text-anchor="middle" font-size="18" fill="#666">展示插入键值导致节点分裂和树结构调整的过程</text>
  
  <!-- ========== 第1步：初始状态 ========== -->
  <rect x="50" y="110" width="1500" height="350" rx="8" ry="8" fill="#f9f9ff" stroke="#666" stroke-width="1"/>
  <text x="800" y="140" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">第1步：初始状态（阶数m=3）</text>
  
  <!-- 初始树结构说明 -->
  <rect x="100" y="160" width="1400" height="80" rx="6" ry="6" fill="#f0f8ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="185" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">初始B+树结构</text>
  <text x="800" y="210" text-anchor="middle" font-size="16">
    阶数m=3（每个节点最多2个键值，3个子节点） | 当前所有节点未满
  </text>
  
  <!-- 初始树结构 -->
  <!-- 根节点 -->
  <g transform="translate(700, 250)">
    <rect width="200" height="80" rx="8" ry="8" fill="#eef2ff" stroke="#4a6bff" stroke-width="3"/>
    <text x="100" y="25" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">根节点</text>
    <rect x="40" y="40" width="120" height="30" rx="4" ry="4" fill="#ffffff" stroke="#4a6bff" stroke-width="2"/>
    <line x1="90" y1="40" x2="90" y2="70" stroke="#4a6bff" stroke-width="1"/>
    <text x="65" y="60" text-anchor="middle" font-size="18" font-weight="bold">20</text>
    <text x="115" y="60" text-anchor="middle" font-size="18" font-weight="bold">40</text>
  </g>
  
  <!-- 连接线 -->
  <path d="M800,330 L650,400" stroke="#4a6bff" stroke-width="2" fill="none"/>
  <path d="M800,330 L800,400" stroke="#4a6bff" stroke-width="2" fill="none"/>
  <path d="M800,330 L950,400" stroke="#4a6bff" stroke-width="2" fill="none"/>
  
  <!-- 分支节点 -->
  <!-- 左分支 -->
  <g transform="translate(500, 420)">
    <rect width="150" height="70" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="2"/>
    <text x="75" y="25" text-anchor="middle" font-size="16" font-weight="bold">左分支</text>
    <rect x="25" y="35" width="100" height="25" rx="3" ry="3" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <text x="75" y="52" text-anchor="middle" font-size="16">10</text>
  </g>
  
  <!-- 中分支 -->
  <g transform="translate(700, 420)">
    <rect width="150" height="70" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="2"/>
    <text x="75" y="25" text-anchor="middle" font-size="16" font-weight="bold">中分支</text>
    <rect x="25" y="35" width="100" height="25" rx="3" ry="3" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <text x="75" y="52" text-anchor="middle" font-size="16">30</text>
  </g>
  
  <!-- 右分支 -->
  <g transform="translate(900, 420)">
    <rect width="150" height="70" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="2"/>
    <text x="75" y="25" text-anchor="middle" font-size="16" font-weight="bold">右分支</text>
    <rect x="25" y="35" width="100" height="25" rx="3" ry="3" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <text x="75" y="52" text-anchor="middle" font-size="16">50</text>
  </g>
  
  <!-- 连接线到叶子节点 -->
  <g transform="translate(575, 490)">
    <path d="M0,0 L-50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
    <path d="M0,0 L50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
  </g>
  
  <g transform="translate(775, 490)">
    <path d="M0,0 L-50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
    <path d="M0,0 L50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
  </g>
  
  <g transform="translate(975, 490)">
    <path d="M0,0 L-50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
    <path d="M0,0 L50,30" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
  </g>
  
  <!-- 叶子节点层 -->
  <rect x="300" y="520" width="1000" height="40" fill="#f8f8f8" stroke="#ccc" stroke-width="1"/>
  <text x="800" y="545" text-anchor="middle" font-size="18" font-weight="bold" fill="#666">叶子节点层</text>
  
  <!-- 叶子节点 -->
  <!-- 叶子1 -->
  <g transform="translate(350, 560)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子1</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">5, 8</text>
  </g>
  
  <!-- 叶子2 -->
  <g transform="translate(500, 560)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子2</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">12, 15</text>
  </g>
  
  <!-- 叶子3 -->
  <g transform="translate(650, 560)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子3</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">25, 28</text>
  </g>
  
  <!-- 叶子4 -->
  <g transform="translate(800, 560)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子4</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">35, 38</text>
  </g>
  
  <!-- 叶子5 -->
  <g transform="translate(950, 560)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子5</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">55, 60</text>
  </g>
  
  <!-- 叶子节点链表 -->
  <path d="M470,600 L500,600" stroke="#ff6b35" stroke-width="2" fill="none"/>
  <path d="M620,600 L650,600" stroke="#ff6b35" stroke-width="2" fill="none"/>
  <path d="M770,600 L800,600" stroke="#ff6b35" stroke-width="2" fill="none"/>
  <path d="M920,600 L950,600" stroke="#ff6b35" stroke-width="2" fill="none"/>
  
  <!-- ========== 第2步：插入键值17 ========== -->
  <rect x="50" y="670" width="1500" height="350" rx="8" ry="8" fill="#f9f9ff" stroke="#666" stroke-width="1"/>
  <text x="800" y="700" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">第2步：插入键值17（简单插入）</text>
  
  <!-- 操作说明 -->
  <rect x="100" y="730" width="1400" height="80" rx="6" ry="6" fill="#f0f8ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="755" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">插入操作：键值17应插入到叶子节点2</text>
  <text x="800" y="780" text-anchor="middle" font-size="16">
    查找路径：根节点(20,40) → 中分支(30) → 叶子节点2(12,15) | 叶子节点2未满，直接插入
  </text>
  
  <!-- 插入标记 -->
  <rect x="450" y="820" width="200" height="50" rx="8" ry="8" fill="#ff3366" stroke="#cc0033" stroke-width="2"/>
  <text x="550" y="845" text-anchor="middle" font-size="20" font-weight="bold" fill="white">插入: 17</text>
  
  <!-- 插入箭头 -->
  <path d="M550,870 L550,895" stroke="#ff3366" stroke-width="3" fill="none" marker-end="url(#insert-arrow)"/>
  
  <!-- 插入前的叶子节点2 -->
  <g transform="translate(500, 900)">
    <rect width="120" height="80" rx="6" ry="6" fill="#ffe6e6" stroke="#ff3366" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子2(插入前)</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#ff3366" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">12, 15</text>
    <text x="60" y="70" text-anchor="middle" font-size="12" fill="#666">已满: 否</text>
  </g>
  
  <!-- 箭头 -->
  <text x="620" y="940" text-anchor="middle" font-size="24" font-weight="bold">→</text>
  
  <!-- 插入后的叶子节点2 -->
  <g transform="translate(700, 900)">
    <rect width="120" height="80" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" font-size="14" font-weight="bold">叶子2(插入后)</text>
    <rect x="15" y="35" width="90" height="20" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="60" y="48" text-anchor="middle" font-size="14">12, 15, 17</text>
    <text x="60" y="70" text-anchor="middle" font-size="12" fill="#666">已满: 否</text>
  </g>
  
  <!-- 插入后状态说明 -->
  <rect x="100" y="1000" width="1400" height="60" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="1"/>
  <text x="800" y="1020" text-anchor="middle" font-size="16" font-weight="bold" fill="#1e7a34">插入完成：叶子节点2未满，直接插入键值17，无需分裂</text>
  <text x="800" y="1040" text-anchor="middle" font-size="14">树结构保持不变，只是叶子节点2的内容从[12,15]变为[12,15,17]</text>
  
  <!-- ========== 第3步：插入键值18（导致叶子节点分裂） ========== -->
  <rect x="50" y="1080" width="1500" height="400" rx="8" ry="8" fill="#f9f9ff" stroke="#666" stroke-width="1"/>
  <text x="800" y="1110" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">第3步：插入键值18（导致叶子节点分裂）</text>
  
  <!-- 操作说明 -->
  <rect x="100" y="1140" width="1400" height="80" rx="6" ry="6" fill="#f0f8ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="1165" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">插入操作：键值18应插入到叶子节点2</text>
  <text x="800" y="1190" text-anchor="middle" font-size="16">
    查找路径：根节点(20,40) → 中分支(30) → 叶子节点2(12,15,17) | 叶子节点2已满，需要分裂
  </text>
  
  <!-- 插入标记 -->
  <rect x="450" y="1230" width="200" height="50" rx="8" ry="8" fill="#ff3366" stroke="#cc0033" stroke-width="2"/>
  <text x="550" y="1255" text-anchor="middle" font-size="20" font-weight="bold" fill="white">插入: 18</text>
  
  <!-- 分裂过程展示 -->
  <text x="800" y="1300" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">叶子节点分裂过程</text>
  
  <!-- 分裂前 -->
  <g transform="translate(400, 1320)">
    <rect width="200" height="100" rx="8" ry="8" fill="#ffe6e6" stroke="#ff3366" stroke-width="2"/>
    <text x="100" y="25" text-anchor="middle" font-size="16" font-weight="bold">叶子节点2（分裂前）</text>
    <rect x="20" y="40" width="160" height="30" rx="4" ry="4" fill="#ffffff" stroke="#ff3366" stroke-width="1"/>
    <text x="100" y="60" text-anchor="middle" font-size="16">键值: [12, 15, 17]</text>
    <text x="100" y="85" text-anchor="middle" font-size="14" fill="#666">已满，需要分裂</text>
  </g>
  
  <!-- 箭头 -->
  <text x="650" y="1370" text-anchor="middle" font-size="24" font-weight="bold">→</text>
  
  <!-- 分裂后 -->
  <g transform="translate(700, 1320)">
    <!-- 新叶子节点2 -->
    <rect width="180" height="100" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" font-size="14" font-weight="bold">新叶子节点2</text>
    <rect x="20" y="40" width="140" height="25" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="90" y="55" text-anchor="middle" font-size="14">键值: [12, 15]</text>
  </g>
  
  <g transform="translate(900, 1320)">
    <!-- 新叶子节点2a -->
    <rect width="180" height="100" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" font-size="14" font-weight="bold">新叶子节点2a</text>
    <rect x="20" y="40" width="140" height="25" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="90" y="55" text-anchor="middle" font-size="14">键值: [17, 18]</text>
  </g>
  
  <!-- 中间键值提升 -->
  <g transform="translate(850, 1320)">
    <rect x="-30" y="70" width="60" height="40" rx="4" ry="4" fill="#4a6bff" stroke="#2d4cd2" stroke-width="2"/>
    <text x="0" y="95" text-anchor="middle" font-size="16" font-weight="bold" fill="white">17↑</text>
  </g>
  
  <!-- 箭头 -->
  <path d="M850,1350 L850,1400" stroke="#4a6bff" stroke-width="2" fill="none" marker-end="url(#up-arrow)"/>
  
  <!-- 父节点更新 -->
  <g transform="translate(700, 1420)">
    <rect width="300" height="80" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="2"/>
    <text x="150" y="25" text-anchor="middle" font-size="16" font-weight="bold">中分支节点（更新后）</text>
    <rect x="50" y="40" width="200" height="30" rx="4" ry="4" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <line x1="100" y1="40" x2="100" y2="70" stroke="#4a6bff" stroke-width="1"/>
    <text x="75" y="60" text-anchor="middle" font-size="16">17</text>
    <text x="150" y="60" text-anchor="middle" font-size="16">30</text>
  </g>
  
  <!-- 分裂结果说明 -->
  <rect x="100" y="1520" width="1400" height="60" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="1540" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d4cd2">分裂完成：叶子节点2分裂为两个节点，中间键值17提升到父节点</text>
  <text x="800" y="1560" text-anchor="middle" font-size="14">中分支节点从[30]更新为[17,30]，现在有3个子节点指针</text>
  
  <!-- ========== 第4步：插入键值19（导致父节点分裂，树高增加） ========== -->
  <rect x="50" y="1610" width="1500" height="380" rx="8" ry="8" fill="#f9f9ff" stroke="#666" stroke-width="1"/>
  <text x="800" y="1640" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">第4步：插入键值19（导致父节点分裂，树高增加）</text>
  
  <!-- 操作说明 -->
  <rect x="100" y="1670" width="1400" height="80" rx="6" ry="6" fill="#f0f8ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="1695" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">插入操作：键值19应插入到叶子节点2a</text>
  <text x="800" y="1720" text-anchor="middle" font-size="16">
    查找路径：根节点(20,40) → 中分支(17,30) → 叶子节点2a(17,18) | 叶子节点2a已满，需要分裂
  </text>
  
  <!-- 插入标记 -->
  <rect x="450" y="1760" width="200" height="50" rx="8" ry="8" fill="#ff3366" stroke="#cc0033" stroke-width="2"/>
  <text x="550" y="1785" text-anchor="middle" font-size="20" font-weight="bold" fill="white">插入: 19</text>
  
  <!-- 复杂分裂过程 -->
  <text x="800" y="1850" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">连锁分裂过程：叶子分裂 → 父节点分裂 → 树高增加</text>
  
  <!-- 步骤1：叶子节点分裂 -->
  <g transform="translate(200, 1880)">
    <rect width="250" height="100" rx="6" ry="6" fill="#e6ffe6" stroke="#34c759" stroke-width="1"/>
    <text x="125" y="25" text-anchor="middle" font-size="14" font-weight="bold">步骤1: 叶子节点2a分裂</text>
    <rect x="40" y="40" width="170" height="30" rx="3" ry="3" fill="#ffffff" stroke="#34c759" stroke-width="1"/>
    <text x="125" y="60" text-anchor="middle" font-size="14">[17,18] → [17] + [18,19]</text>
    <text x="125" y="85" text-anchor="middle" font-size="12">中间值18提升到父节点</text>
  </g>
  
  <!-- 箭头 -->
  <text x="500" y="1930" text-anchor="middle" font-size="24" font-weight="bold">→</text>
  
  <!-- 步骤2：父节点分裂 -->
  <g transform="translate(600, 1880)">
    <rect width="250" height="100" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="1"/>
    <text x="125" y="25" text-anchor="middle" font-size="14" font-weight="bold">步骤2: 中分支节点分裂</text>
    <rect x="40" y="40" width="170" height="30" rx="3" ry="3" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <text x="125" y="60" text-anchor="middle" font-size="14">[17,18,30] → [17] + [30]</text>
    <text x="125" y="85" text-anchor="middle" font-size="12">中间值18提升到根节点</text>
  </g>
  
  <!-- 箭头 -->
  <text x="900" y="1930" text-anchor="middle" font-size="24" font-weight="bold">→</text>
  
  <!-- 步骤3：根节点分裂 -->
  <g transform="translate(1000, 1880)">
    <rect width="250" height="100" rx="6" ry="6" fill="#eef2ff" stroke="#4a6bff" stroke-width="1"/>
    <text x="125" y="25" text-anchor="middle" font-size="14" font-weight="bold">步骤3: 根节点分裂</text>
    <rect x="40" y="40" width="170" height="30" rx="3" ry="3" fill="#ffffff" stroke="#4a6bff" stroke-width="1"/>
    <text x="125" y="60" text-anchor="middle" font-size="14">[18,20,40] → [18] + [40]</text>
    <text x="125" y="85" text-anchor="middle" font-size="12">中间值20成为新根节点</text>
  </g>
  
  <!-- 最终树结构 -->
  <rect x="100" y="2000" width="1400" height="120" rx="6" ry="6" fill="#f0f8ff" stroke="#4a6bff" stroke-width="1"/>
  <text x="800" y="2025" text-anchor="middle" font-size="18" font-weight="bold" fill="#2d4cd2">最终树结构（树高从2层变为3层）</text>
  
  <!-- 新树结构简图 -->
  <g transform="translate(800, 2060)">
    <!-- 新根节点 -->
    <rect x="-50" y="-15" width="100" height="40" rx="4" ry="4" fill="#4a6bff" stroke="#2d4cd2" stroke-width="2"/>
    <text x="0" y="5" text-anchor="middle" font-size="16" font-weight="bold" fill="white">20</text>
    
    <!-- 第二层 -->
    <rect x="-150" y="40" width="80" height="35" rx="4" ry="4" fill="#eef2ff" stroke="#4a6bff" stroke-width="1"/>
    <text x="-110" y="62" text-anchor="middle" font-size="14">18</text>
    
    <rect x="70" y="40" width="80" height="35" rx="4" ry="4" fill="#eef2ff" stroke="#4a6bff" stroke-width="1"/>
    <text x="110" y="62" text-anchor="middle" font-size="14">40</text>
    
    <!-- 连接线 -->
    <path d="M-50,25 L-110,40" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
    <path d="M50,25 L110,40" stroke="#4a6bff" stroke-width="1.5" fill="none"/>
    
    <!-- 树高说明 -->
    <text x="0" y="90" text-anchor="middle" font-size="14" fill="#666">树高: 3层（增加1层）</text>
  </g>
  
  <!-- ========== 箭头定义 ========== -->
  <defs>
    <!-- 插入箭头 -->
    <marker id="insert-arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff3366"/>
    </marker>
    
    <!-- 向上箭头 -->
    <marker id="up-arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 10 L 5 0 L 10 10 z" fill="#4a6bff"/>
    </marker>
  </defs>
</svg>