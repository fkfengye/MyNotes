<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InnoDB CheckpointæŠ€æœ¯è¯¦è§£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #004d40 0%, #00796b 100%);
            color: white;
            padding: 30px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 900px;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            border-right: 1px solid #eaeaea;
            min-width: 900px;
        }
        
        .sidebar {
            width: 450px;
            padding: 30px;
            background-color: #f9fafc;
            overflow-y: auto;
            max-height: 1200px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #004d40;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        h3 {
            font-size: 1.4rem;
            margin: 25px 0 15px;
            color: #00796b;
        }
        
        h4 {
            font-size: 1.1rem;
            margin: 20px 0 10px;
            color: #333;
        }
        
        .checkpoint-types {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .type-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 4px solid #00796b;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .type-card.active {
            border-top-color: #ff9800;
            background-color: #e0f2f1;
        }
        
        .type-card.sharp {
            border-top-color: #4caf50;
        }
        
        .type-card.fuzzy {
            border-top-color: #2196f3;
        }
        
        .type-card.async {
            border-top-color: #ff9800;
        }
        
        .type-card.sync {
            border-top-color: #f44336;
        }
        
        .type-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 1.5rem;
            color: white;
        }
        
        .sharp .type-icon {
            background-color: #4caf50;
        }
        
        .fuzzy .type-icon {
            background-color: #2196f3;
        }
        
        .async .type-icon {
            background-color: #ff9800;
        }
        
        .sync .type-icon {
            background-color: #f44336;
        }
        
        .type-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .type-description {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .type-characteristics {
            font-size: 0.9rem;
            color: #666;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .checkpoint-visual {
            margin-top: 30px;
            padding: 25px;
            background-color: #f5f5f5;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            height: 500px;
        }
        
        #checkpointCanvas {
            width: 100%;
            height: 100%;
            background-color: white;
            border-radius: 6px;
        }
        
        .technical-details {
            margin-top: 30px;
            padding: 25px;
            background-color: #e0f2f1;
            border-radius: 8px;
            border-left: 4px solid #00796b;
        }
        
        .detail-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #b2dfdb;
        }
        
        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .detail-title {
            font-weight: 600;
            color: #004d40;
            margin-bottom: 5px;
        }
        
        .detail-description {
            font-size: 0.95rem;
            color: #555;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background-color: #00796b;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #004d40;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 121, 107, 0.2);
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        
        .sidebar-content {
            margin-top: 20px;
        }
        
        .checkpoint-timeline {
            margin-top: 25px;
            margin-bottom: 30px;
        }
        
        .timeline-item {
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #00796b;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .timeline-item.active {
            background-color: #b2dfdb;
            border-left-color: #ff9800;
        }
        
        .timeline-step {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: #00796b;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.8rem;
        }
        
        .timeline-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .timeline-description {
            font-size: 0.85rem;
            color: #666;
            margin-left: 34px;
        }
        
        .parameter-container {
            margin-top: 30px;
            overflow-x: auto;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 400px;
        }
        
        .parameter-table th {
            background-color: #00796b;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .parameter-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: top;
        }
        
        .parameter-table tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        
        .parameter-table tr:hover {
            background-color: #e0f2f1;
        }
        
        .parameter-name {
            font-weight: 600;
            color: #004d40;
            white-space: nowrap;
            min-width: 200px;
        }
        
        .parameter-value {
            font-family: 'Courier New', monospace;
            color: #d32f2f;
            min-width: 100px;
        }
        
        .parameter-description {
            font-size: 0.9rem;
            color: #555;
            min-width: 250px;
        }
        
        .algorithm-explanation {
            margin-top: 30px;
            padding: 20px;
            background-color: #f3e5f5;
            border-radius: 8px;
            border-left: 4px solid #9c27b0;
        }
        
        .algorithm-explanation h3 {
            color: #9c27b0;
        }
        
        .algorithm-step {
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
            margin-top: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-running {
            background-color: #4caf50;
            animation: pulse 1.5s infinite;
        }
        
        .status-paused {
            background-color: #ff9800;
        }
        
        .status-stopped {
            background-color: #f44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .performance-metrics {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metric-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #00796b;
        }
        
        .metric-name {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #004d40;
        }
        
        .metric-unit {
            font-size: 0.8rem;
            color: #888;
            margin-left: 5px;
        }
        
        @media (max-width: 1200px) {
            .content {
                flex-direction: column;
            }
            
            .main-content, .sidebar {
                width: 100%;
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>InnoDB CheckpointæŠ€æœ¯è¯¦è§£</h1>
            <p class="subtitle">æ·±å…¥è§£æInnoDBå­˜å‚¨å¼•æ“çš„æ£€æŸ¥ç‚¹æœºåˆ¶ï¼šSharp Checkpointã€Fuzzy Checkpointã€LSNæœºåˆ¶ä¸æ¢å¤åŸç†</p>
        </header>
        
        <div class="content">
            <div class="main-content">
                <h2>CheckpointæŠ€æœ¯ç±»å‹</h2>
                
                <div class="checkpoint-types">
                    <div class="type-card sharp active" data-type="sharp">
                        <div class="type-icon">âš¡</div>
                        <div class="type-title">Sharp Checkpoint</div>
                        <div class="type-description">
                            å®Œå…¨æ£€æŸ¥ç‚¹ï¼Œä¸€æ¬¡æ€§å°†æ‰€æœ‰è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚å‘ç”Ÿåœ¨æ•°æ®åº“å…³é—­æ—¶æˆ–æ‰§è¡Œç‰¹å®šå‘½ä»¤æ—¶ã€‚
                        </div>
                        <div class="type-characteristics">
                            <strong>ç‰¹ç‚¹ï¼š</strong> é˜»å¡æ“ä½œã€åˆ·æ–°æ‰€æœ‰è„é¡µã€æ¢å¤æ—¶é—´æœ€çŸ­
                        </div>
                    </div>
                    
                    <div class="type-card fuzzy" data-type="fuzzy">
                        <div class="type-icon">ğŸŒ«ï¸</div>
                        <div class="type-title">Fuzzy Checkpoint</div>
                        <div class="type-description">
                            æ¨¡ç³Šæ£€æŸ¥ç‚¹ï¼Œåªåˆ·æ–°éƒ¨åˆ†è„é¡µåˆ°ç£ç›˜ã€‚å‘ç”Ÿåœ¨æ•°æ®åº“è¿è¡ŒæœŸé—´ï¼Œé¿å…æ€§èƒ½å½±å“ã€‚
                        </div>
                        <div class="type-characteristics">
                            <strong>ç‰¹ç‚¹ï¼š</strong> éé˜»å¡ã€å¢é‡åˆ·æ–°ã€å¯¹æ€§èƒ½å½±å“å°
                        </div>
                    </div>
                    
                    <div class="type-card async" data-type="async">
                        <div class="type-icon">ğŸ”„</div>
                        <div class="type-title">Async/Sync Flush Checkpoint</div>
                        <div class="type-description">
                            å½“Redo Logæ–‡ä»¶ä¸å¯ç”¨æ—¶è§¦å‘ï¼Œç¡®ä¿é‡åšæ—¥å¿—å¯ä»¥å®‰å…¨è¦†ç›–ã€‚
                        </div>
                        <div class="type-characteristics">
                            <strong>ç‰¹ç‚¹ï¼š</strong> ç”±Page Cleanerçº¿ç¨‹æ‰§è¡Œã€åŸºäºLSNè®¡ç®—
                        </div>
                    </div>
                    
                    <div class="type-card sync" data-type="sync">
                        <div class="type-icon">ğŸ“Š</div>
                        <div class="type-title">Dirty Page too much Checkpoint</div>
                        <div class="type-description">
                            å½“Buffer Poolä¸­è„é¡µæ¯”ä¾‹è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘ï¼Œé˜²æ­¢è„é¡µè¿‡å¤šå½±å“æ€§èƒ½ã€‚
                        </div>
                        <div class="type-characteristics">
                            <strong>ç‰¹ç‚¹ï¼š</strong> åŸºäºè„é¡µæ¯”ä¾‹ã€è‡ªé€‚åº”è§¦å‘ã€é˜²æ­¢å†…å­˜å‹åŠ›
                        </div>
                    </div>
                </div>
                
                <h3>Checkpointæœºåˆ¶å¯è§†åŒ–</h3>
                <div class="checkpoint-visual">
                    <canvas id="checkpointCanvas"></canvas>
                </div>
                
                <div class="technical-details" id="technicalDetails">
                    <h3>Sharp CheckpointæŠ€æœ¯è¯¦æƒ…</h3>
                    <div class="detail-item">
                        <div class="detail-title">è§¦å‘æ—¶æœº</div>
                        <div class="detail-description">
                            1. æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆSHUTDOWNï¼‰<br>
                            2. è®¾ç½®innodb_fast_shutdown=0æ—¶<br>
                            3. æ‰§è¡ŒFLUSH TABLES WITH READ LOCKå‘½ä»¤<br>
                            4. å¤‡ä»½å·¥å…·è¯·æ±‚ä¸€è‡´æ€§å¤‡ä»½æ—¶
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">æ‰§è¡Œè¿‡ç¨‹</div>
                        <div class="detail-description">
                            1. åœæ­¢æ¥å—æ–°çš„äº‹åŠ¡è¯·æ±‚<br>
                            2. ç­‰å¾…æ‰€æœ‰æ´»è·ƒäº‹åŠ¡å®Œæˆ<br>
                            3. å°†Buffer Poolä¸­æ‰€æœ‰è„é¡µåˆ·æ–°åˆ°ç£ç›˜<br>
                            4. æ›´æ–°Checkpoint LSNåˆ°æœ€æ–°çš„ä½ç½®<br>
                            5. å†™å…¥ä¸€ä¸ªç‰¹æ®Šçš„æ£€æŸ¥ç‚¹è®°å½•åˆ°é‡åšæ—¥å¿—
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">ä¼˜ç¼ºç‚¹åˆ†æ</div>
                        <div class="detail-description">
                            <strong>ä¼˜ç‚¹ï¼š</strong>æ¢å¤æ—¶é—´æœ€çŸ­ï¼Œæ•°æ®ä¸€è‡´æ€§æœ€é«˜<br>
                            <strong>ç¼ºç‚¹ï¼š</strong>é˜»å¡æ•°æ®åº“æœåŠ¡ï¼Œæ€§èƒ½å½±å“å¤§ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒé¢‘ç¹ä½¿ç”¨
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <h2>Checkpointæ‰§è¡Œæµç¨‹</h2>
                
                <div class="controls">
                    <button id="startCheckpointBtn" class="btn-primary">å¼€å§‹Checkpointæµç¨‹</button>
                    <button id="resetBtn" class="btn-secondary">é‡ç½®</button>
                </div>
                
                <div class="checkpoint-timeline" id="checkpointTimeline">
                    <!-- æ—¶é—´çº¿å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="sidebar-content">
                    <h3>å…³é”®å‚æ•°é…ç½®</h3>
                    <div class="parameter-container">
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th style="width: 180px;">å‚æ•°</th>
                                    <th style="width: 120px;">é»˜è®¤å€¼</th>
                                    <th>è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="parameter-name">innodb_max_dirty_pages_pct</td>
                                    <td class="parameter-value">75%</td>
                                    <td class="parameter-description">è§¦å‘Dirty Page Checkpointçš„è„é¡µæ¯”ä¾‹é˜ˆå€¼ã€‚å½“Buffer Poolä¸­è„é¡µæ¯”ä¾‹è¶…è¿‡æ­¤å€¼æ—¶è§¦å‘æ£€æŸ¥ç‚¹ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_max_dirty_pages_pct_lwm</td>
                                    <td class="parameter-value">0%</td>
                                    <td class="parameter-description">ä½æ°´ä½æ ‡è®°ï¼Œæå‰å¼€å§‹åˆ·æ–°è„é¡µçš„é˜ˆå€¼ã€‚å½“è„é¡µæ¯”ä¾‹è¶…è¿‡æ­¤å€¼æ—¶ï¼Œå¼€å§‹é¢„åˆ·æ–°ä»¥é˜²æ­¢è¾¾åˆ°ä¸Šé™ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_io_capacity</td>
                                    <td class="parameter-value">200</td>
                                    <td class="parameter-description">æ¯ç§’å¯æ‰§è¡Œçš„IOæ“ä½œæ•°ï¼ˆé’ˆå¯¹æ—‹è½¬ç£ç›˜ï¼‰ã€‚å½±å“åˆ·æ–°è„é¡µå’Œåˆå¹¶æ’å…¥ç¼“å†²çš„é€Ÿåº¦ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_io_capacity_max</td>
                                    <td class="parameter-value">2000</td>
                                    <td class="parameter-description">IOæ“ä½œçš„æœ€å¤§ä¸Šé™ã€‚åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼ŒInnoDBå¯ä»¥è¶…è¿‡innodb_io_capacityè¾¾åˆ°æ­¤å€¼ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_lru_scan_depth</td>
                                    <td class="parameter-value">1024</td>
                                    <td class="parameter-description">LRUåˆ—è¡¨æ‰«ææ·±åº¦ï¼Œå½±å“é¡µé¢åˆ·æ–°ã€‚Page Cleanerçº¿ç¨‹æ¯æ¬¡æ‰«æLRUåˆ—è¡¨çš„é¡µé¢æ•°ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_adaptive_flushing</td>
                                    <td class="parameter-value">ON</td>
                                    <td class="parameter-description">è‡ªé€‚åº”åˆ·æ–°ï¼Œæ ¹æ®å·¥ä½œè´Ÿè½½è‡ªåŠ¨è°ƒæ•´åˆ·æ–°é€Ÿç‡ã€‚åŸºäºRedo Logç”Ÿæˆé€Ÿç‡åŠ¨æ€è®¡ç®—ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_log_file_size</td>
                                    <td class="parameter-value">48M</td>
                                    <td class="parameter-description">æ¯ä¸ªRedo Logæ–‡ä»¶çš„å¤§å°ã€‚å½±å“æ£€æŸ¥ç‚¹è§¦å‘é¢‘ç‡å’Œæ¢å¤æ—¶é—´ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_log_files_in_group</td>
                                    <td class="parameter-value">2</td>
                                    <td class="parameter-description">Redo Logæ–‡ä»¶ç»„çš„æ–‡ä»¶æ•°é‡ã€‚ä¸innodb_log_file_sizeå…±åŒå†³å®šRedo Logæ€»å®¹é‡ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_flush_neighbors</td>
                                    <td class="parameter-value">1</td>
                                    <td class="parameter-description">åˆ·æ–°ç›¸é‚»é¡µé¢ã€‚å¯¹äºæ—‹è½¬ç£ç›˜ï¼Œåˆ·æ–°è¿ç»­é¡µé¢å¯ä»¥æé«˜IOæ•ˆç‡ã€‚</td>
                                </tr>
                                <tr>
                                    <td class="parameter-name">innodb_buffer_pool_size</td>
                                    <td class="parameter-value">128M</td>
                                    <td class="parameter-description">Buffer Poolå¤§å°ã€‚ç›´æ¥å½±å“å¯ä»¥ç¼“å­˜çš„è„é¡µæ•°é‡ã€‚</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="performance-metrics">
                        <div class="metric-card">
                            <div class="metric-name">å½“å‰è„é¡µæ¯”ä¾‹</div>
                            <div class="metric-value" id="dirtyPageRatio">75%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">Checkpointå¹´é¾„</div>
                            <div class="metric-value" id="checkpointAge">45%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">åˆ·æ–°é€Ÿç‡</div>
                            <div class="metric-value" id="flushRate">200<span class="metric-unit">é¡µ/ç§’</span></div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">Redo Logä½¿ç”¨ç‡</div>
                            <div class="metric-value" id="redoLogUsage">65%</div>
                        </div>
                    </div>
                    
                    <div class="algorithm-explanation">
                        <h3>LSNæœºåˆ¶ä¸æ¢å¤ç®—æ³•</h3>
                        <div class="algorithm-step">
                            <strong>LSNï¼ˆLog Sequence Numberï¼‰</strong><br>
                            æ—¥å¿—åºåˆ—å·ï¼Œå•è°ƒé€’å¢çš„64ä½æ•´æ•°ï¼Œè®°å½•Redo Logçš„å†™å…¥ä½ç½®ã€‚æ¯ä¸ªæ•°æ®é¡µã€Redo Logè®°å½•ã€Checkpointéƒ½æœ‰å¯¹åº”çš„LSNã€‚
                        </div>
                        <div class="algorithm-step">
                            <strong>Checkpoint LSN</strong><br>
                            è®°å½•æœ€åä¸€æ¬¡Checkpointçš„ä½ç½®ï¼Œæ¢å¤æ—¶ä»è¯¥ç‚¹å¼€å§‹ã€‚å­˜å‚¨åœ¨ç³»ç»Ÿè¡¨ç©ºé—´(ibdata)ä¸­ã€‚
                        </div>
                        <div class="algorithm-step">
                            <strong>æ¢å¤ç®—æ³•</strong><br>
                            1. æ‰¾åˆ°æœ€è¿‘çš„Checkpointè®°å½•<br>
                            2. ä»Checkpoint LSNå¼€å§‹é‡æ”¾Redo Log<br>
                            3. åº”ç”¨Undo Logå›æ»šæœªæäº¤äº‹åŠ¡<br>
                            4. æ•°æ®åº“æ¢å¤åˆ°ä¸€è‡´çŠ¶æ€
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>InnoDB CheckpointæŠ€æœ¯è¯¦è§£ | LSNæœºåˆ¶ | å´©æºƒæ¢å¤åŸç† | æ€§èƒ½ä¼˜åŒ–</p>
        </footer>
    </div>

    <script>
        // CheckpointæŠ€æœ¯æ•°æ®
        const checkpointTypes = {
            sharp: {
                title: "Sharp Checkpoint",
                color: "#4caf50",
                steps: [
                    { id: 1, title: "åœæ­¢æ¥å—æ–°äº‹åŠ¡", description: "æš‚åœæ¥å—æ–°çš„äº‹åŠ¡è¯·æ±‚ï¼Œç­‰å¾…å½“å‰äº‹åŠ¡å®Œæˆ" },
                    { id: 2, title: "ç­‰å¾…æ´»è·ƒäº‹åŠ¡", description: "ç­‰å¾…æ‰€æœ‰æ´»è·ƒäº‹åŠ¡æäº¤æˆ–å›æ»šå®Œæˆ" },
                    { id: 3, title: "åˆ·æ–°æ‰€æœ‰è„é¡µ", description: "å°†Buffer Poolä¸­æ‰€æœ‰è„é¡µåŒæ­¥åˆ·æ–°åˆ°ç£ç›˜" },
                    { id: 4, title: "æ›´æ–°Checkpoint LSN", description: "è®°å½•æœ€æ–°çš„æ£€æŸ¥ç‚¹ä½ç½®åˆ°ç³»ç»Ÿè¡¨ç©ºé—´" },
                    { id: 5, title: "å†™å…¥æ£€æŸ¥ç‚¹è®°å½•", description: "åœ¨Redo Logä¸­å†™å…¥ç‰¹æ®Šçš„æ£€æŸ¥ç‚¹è®°å½•" }
                ],
                description: "å®Œå…¨æ£€æŸ¥ç‚¹ï¼Œä¸€æ¬¡æ€§åˆ·æ–°æ‰€æœ‰è„é¡µåˆ°ç£ç›˜ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“å…³é—­æˆ–å¤‡ä»½åœºæ™¯ã€‚",
                characteristics: "é˜»å¡æ“ä½œã€åˆ·æ–°æ‰€æœ‰è„é¡µã€æ¢å¤æ—¶é—´æœ€çŸ­"
            },
            fuzzy: {
                title: "Fuzzy Checkpoint",
                color: "#2196f3",
                steps: [
                    { id: 1, title: "ç¡®å®šåˆ·æ–°èŒƒå›´", description: "åŸºäºLSNè®¡ç®—éœ€è¦åˆ·æ–°çš„è„é¡µèŒƒå›´" },
                    { id: 2, title: "é€‰æ‹©è„é¡µ", description: "ä»Flush Listä¸­é€‰æ‹©æœ€æ—§çš„è„é¡µè¿›è¡Œåˆ·æ–°" },
                    { id: 3, title: "å¼‚æ­¥åˆ·æ–°è„é¡µ", description: "é€šè¿‡Page Cleanerçº¿ç¨‹å¼‚æ­¥åˆ·æ–°é€‰ä¸­çš„è„é¡µ" },
                    { id: 4, title: "æ›´æ–°æ£€æŸ¥ç‚¹ä¿¡æ¯", description: "æ›´æ–°å·²åˆ·æ–°çš„æœ€å°LSNï¼Œä½†ä¸é˜»å¡ç”¨æˆ·æ“ä½œ" },
                    { id: 5, title: "ç»§ç»­æœåŠ¡", description: "æ•°æ®åº“ç»§ç»­æ­£å¸¸æœåŠ¡ï¼Œç”¨æˆ·å‡ ä¹æ— æ„ŸçŸ¥" }
                ],
                description: "æ¨¡ç³Šæ£€æŸ¥ç‚¹ï¼Œå¢é‡åˆ·æ–°éƒ¨åˆ†è„é¡µï¼Œå¯¹æ•°æ®åº“æ€§èƒ½å½±å“æœ€å°ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒçš„ä¸»è¦æ£€æŸ¥ç‚¹ç±»å‹ã€‚",
                characteristics: "éé˜»å¡ã€å¢é‡åˆ·æ–°ã€å¯¹æ€§èƒ½å½±å“å°"
            },
            async: {
                title: "Async/Sync Flush Checkpoint",
                color: "#ff9800",
                steps: [
                    { id: 1, title: "ç›‘æ§Redo Logç©ºé—´", description: "æŒç»­ç›‘æ§Redo Logæ–‡ä»¶çš„å¯ç”¨ç©ºé—´" },
                    { id: 2, title: "è®¡ç®—å®‰å…¨LSN", description: "è®¡ç®—å¯ä»¥å®‰å…¨è¦†ç›–çš„Redo Logä½ç½®" },
                    { id: 3, title: "æ£€æŸ¥è„é¡µLSN", description: "æ£€æŸ¥Buffer Poolä¸­è„é¡µçš„LSNæ˜¯å¦æ—©äºå®‰å…¨LSN" },
                    { id: 4, title: "è§¦å‘å¼ºåˆ¶åˆ·æ–°", description: "å¦‚æœè„é¡µLSNæ—©äºå®‰å…¨LSNï¼Œè§¦å‘å¼ºåˆ¶åˆ·æ–°" },
                    { id: 5, title: "é‡Šæ”¾Redo Logç©ºé—´", description: "åˆ·æ–°å®Œæˆåï¼ŒRedo Logç›¸åº”ç©ºé—´å¯ä»¥è¢«é‡ç”¨" }
                ],
                description: "å½“Redo Logç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œç¡®ä¿å¯ä»¥å®‰å…¨è¦†ç›–æ—§çš„Redo Logè®°å½•ã€‚",
                characteristics: "ç”±Page Cleanerçº¿ç¨‹æ‰§è¡Œã€åŸºäºLSNè®¡ç®—ã€é˜²æ­¢Redo Logå†™æ»¡"
            },
            sync: {
                title: "Dirty Page too much Checkpoint",
                color: "#f44336",
                steps: [
                    { id: 1, title: "ç›‘æ§è„é¡µæ¯”ä¾‹", description: "æŒç»­ç›‘æ§Buffer Poolä¸­è„é¡µçš„æ¯”ä¾‹" },
                    { id: 2, title: "æ£€æŸ¥é˜ˆå€¼", description: "å½“è„é¡µæ¯”ä¾‹è¶…è¿‡innodb_max_dirty_pages_pctæ—¶è§¦å‘" },
                    { id: 3, title: "è®¡ç®—åˆ·æ–°æ•°é‡", description: "åŸºäºå½“å‰è„é¡µæ¯”ä¾‹è®¡ç®—éœ€è¦åˆ·æ–°çš„é¡µé¢æ•°é‡" },
                    { id: 4, title: "å¼‚æ­¥åˆ·æ–°è„é¡µ", description: "å¯åŠ¨åå°çº¿ç¨‹åˆ·æ–°è„é¡µåˆ°ç£ç›˜" },
                    { id: 5, title: "é™ä½è„é¡µæ¯”ä¾‹", description: "å°†è„é¡µæ¯”ä¾‹é™ä½åˆ°å®‰å…¨æ°´å¹³ä»¥ä¸‹" }
                ],
                description: "å½“Buffer Poolä¸­è„é¡µè¿‡å¤šæ—¶è§¦å‘ï¼Œé˜²æ­¢è„é¡µå ç”¨è¿‡å¤šå†…å­˜å½±å“æ•°æ®åº“æ€§èƒ½ã€‚",
                characteristics: "åŸºäºè„é¡µæ¯”ä¾‹ã€è‡ªé€‚åº”è§¦å‘ã€é˜²æ­¢å†…å­˜å‹åŠ›"
            }
        };

        // è·å–DOMå…ƒç´ 
        const checkpointCanvas = document.getElementById('checkpointCanvas');
        const ctx = checkpointCanvas.getContext('2d');
        const typeCards = document.querySelectorAll('.type-card');
        const technicalDetails = document.getElementById('technicalDetails');
        const checkpointTimeline = document.getElementById('checkpointTimeline');
        const startCheckpointBtn = document.getElementById('startCheckpointBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // æ€§èƒ½æŒ‡æ ‡å…ƒç´ 
        const dirtyPageRatio = document.getElementById('dirtyPageRatio');
        const checkpointAge = document.getElementById('checkpointAge');
        const flushRate = document.getElementById('flushRate');
        const redoLogUsage = document.getElementById('redoLogUsage');

        // å½“å‰é€‰ä¸­çš„Checkpointç±»å‹
        let currentCheckpointType = 'sharp';
        let currentStep = 0;
        let animationInterval = null;
        let isRunning = false;

        // åˆå§‹åŒ–ç”»å¸ƒå¤§å°
        function initCanvasSize() {
            const container = checkpointCanvas.parentElement;
            checkpointCanvas.width = container.clientWidth;
            checkpointCanvas.height = container.clientHeight;
        }

        // ç»˜åˆ¶Checkpointæµç¨‹å›¾
        function drawCheckpointFlow() {
            const type = checkpointTypes[currentCheckpointType];
            const steps = type.steps;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, checkpointCanvas.width, checkpointCanvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#f9f9f9';
            ctx.fillRect(0, 0, checkpointCanvas.width, checkpointCanvas.height);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${type.title}æ‰§è¡Œæµç¨‹`, checkpointCanvas.width / 2, 40);
            
            // ç»˜åˆ¶Buffer PoolåŒºåŸŸ
            drawBufferPool();
            
            // ç»˜åˆ¶Redo LogåŒºåŸŸ
            drawRedoLog();
            
            // ç»˜åˆ¶ç£ç›˜åŒºåŸŸ
            drawDiskStorage();
            
            // ç»˜åˆ¶æ­¥éª¤è¯´æ˜
            drawStepDescription(steps);
            
            // ç»˜åˆ¶æ•°æ®æµåŠ¨
            drawDataFlow(steps);
        }

        // ç»˜åˆ¶Buffer Pool
        function drawBufferPool() {
            const x = 50;
            const y = 80;
            const width = 250;
            const height = 150;
            
            // Buffer Poolè¾¹æ¡†
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            // Buffer Poolæ ‡é¢˜
            ctx.fillStyle = '#2196f3';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Buffer Pool', x + width/2, y - 10);
            
            // ç»˜åˆ¶è„é¡µå’Œå¹²å‡€é¡µ
            const pageSize = 20;
            const cols = 8;
            const rows = 5;
            
            // æ ¹æ®å½“å‰æ­¥éª¤ç¡®å®šè„é¡µæ¯”ä¾‹
            let dirtyRatio = 0.7;
            if (currentCheckpointType === 'sync') {
                dirtyRatio = Math.min(0.9, 0.5 + currentStep * 0.1);
            }
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const pageX = x + 10 + col * (pageSize + 5);
                    const pageY = y + 10 + row * (pageSize + 5);
                    const isDirty = Math.random() < dirtyRatio;
                    
                    // ç»˜åˆ¶é¡µé¢
                    ctx.fillStyle = isDirty ? '#ff9800' : '#4caf50';
                    ctx.fillRect(pageX, pageY, pageSize, pageSize);
                    
                    // é¡µé¢è¾¹æ¡†
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(pageX, pageY, pageSize, pageSize);
                    
                    // è„é¡µæ ‡è®°
                    if (isDirty && currentStep > 0) {
                        ctx.fillStyle = '#f44336';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('D', pageX + pageSize/2, pageY + pageSize/2);
                    }
                }
            }
            
            // æ˜¾ç¤ºè„é¡µæ¯”ä¾‹
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`è„é¡µæ¯”ä¾‹: ${Math.round(dirtyRatio * 100)}%`, x, y + height + 15);
        }

        // ç»˜åˆ¶Redo Log
        function drawRedoLog() {
            const x = 350;
            const y = 80;
            const width = 250;
            const height = 150;
            
            // Redo Logè¾¹æ¡†
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            // Redo Logæ ‡é¢˜
            ctx.fillStyle = '#f44336';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Redo Log', x + width/2, y - 10);
            
            // ç»˜åˆ¶Redo Logæ¡ç›®
            const logHeight = 15;
            const logCount = 8;
            
            // è®¡ç®—æ£€æŸ¥ç‚¹ä½ç½®
            let checkpointPos = 3;
            if (currentStep > 2) {
                checkpointPos = Math.min(6, 3 + currentStep);
            }
            
            for (let i = 0; i < logCount; i++) {
                const logY = y + 10 + i * (logHeight + 5);
                
                // ç»˜åˆ¶æ—¥å¿—æ¡ç›®
                ctx.fillStyle = i < checkpointPos ? '#ffcdd2' : '#ffebee';
                ctx.fillRect(x + 10, logY, width - 20, logHeight);
                
                // æ—¥å¿—æ¡ç›®è¾¹æ¡†
                ctx.strokeStyle = '#c62828';
                ctx.lineWidth = 1;
                ctx.strokeRect(x + 10, logY, width - 20, logHeight);
                
                // æ—¥å¿—å†…å®¹
                ctx.fillStyle = '#333';
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`LSN: ${1000 + i * 100}`, x + 15, logY + logHeight/2 + 3);
                
                // æ£€æŸ¥ç‚¹æ ‡è®°
                if (i === checkpointPos && currentStep > 2) {
                    ctx.fillStyle = '#4caf50';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText('âœ“ Checkpoint', x + width - 15, logY + logHeight/2 + 3);
                }
            }
            
            // æ˜¾ç¤ºLSNä¿¡æ¯
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Checkpoint LSN: ${1000 + checkpointPos * 100}`, x, y + height + 15);
        }

        // ç»˜åˆ¶ç£ç›˜å­˜å‚¨
        function drawDiskStorage() {
            const x = 650;
            const y = 80;
            const width = 250;
            const height = 150;
            
            // ç£ç›˜è¾¹æ¡†
            ctx.strokeStyle = '#9c27b0';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            // ç£ç›˜æ ‡é¢˜
            ctx.fillStyle = '#9c27b0';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Disk Storage', x + width/2, y - 10);
            
            // ç»˜åˆ¶æ•°æ®é¡µ
            const pageSize = 25;
            const cols = 6;
            const rows = 4;
            
            // æ ¹æ®å½“å‰æ­¥éª¤ç¡®å®šå·²åˆ·æ–°é¡µé¢
            let flushedPages = 0;
            if (currentStep > 1) {
                flushedPages = Math.min(cols * rows, (currentStep - 1) * 4);
            }
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const pageX = x + 10 + col * (pageSize + 5);
                    const pageY = y + 10 + row * (pageSize + 5);
                    const pageIndex = row * cols + col;
                    const isFlushed = pageIndex < flushedPages;
                    
                    // ç»˜åˆ¶é¡µé¢
                    ctx.fillStyle = isFlushed ? '#e1bee7' : '#f3e5f5';
                    ctx.fillRect(pageX, pageY, pageSize, pageSize);
                    
                    // é¡µé¢è¾¹æ¡†
                    ctx.strokeStyle = '#7b1fa2';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(pageX, pageY, pageSize, pageSize);
                    
                    // å·²åˆ·æ–°æ ‡è®°
                    if (isFlushed) {
                        ctx.fillStyle = '#7b1fa2';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('âœ“', pageX + pageSize/2, pageY + pageSize/2);
                    }
                }
            }
            
            // æ˜¾ç¤ºåˆ·æ–°è¿›åº¦
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`å·²åˆ·æ–°: ${flushedPages}/${cols * rows}é¡µ`, x, y + height + 15);
        }

        // ç»˜åˆ¶æ­¥éª¤è¯´æ˜
        function drawStepDescription(steps) {
            const x = 50;
            const y = 280;
            const stepWidth = 150;
            
            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepX = x + i * (stepWidth + 20);
                
                // æ­¥éª¤æ¡†
                ctx.fillStyle = i < currentStep ? checkpointTypes[currentCheckpointType].color : '#e0e0e0';
                ctx.fillRect(stepX, y, stepWidth, 60);
                
                // æ­¥éª¤è¾¹æ¡†
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.strokeRect(stepX, y, stepWidth, 60);
                
                // æ­¥éª¤ç¼–å·
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`æ­¥éª¤ ${step.id}`, stepX + stepWidth/2, y + 20);
                
                // æ­¥éª¤æ ‡é¢˜
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(step.title, stepX + stepWidth/2, y + 40);
            }
        }

        // ç»˜åˆ¶æ•°æ®æµåŠ¨
        function drawDataFlow(steps) {
            // ç»˜åˆ¶Buffer Poolåˆ°ç£ç›˜çš„ç®­å¤´
            if (currentStep >= 3) {
                ctx.strokeStyle = '#ff9800';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(300, 155); // Buffer Poolå³ä¾§
                ctx.lineTo(650, 155); // ç£ç›˜å·¦ä¾§
                ctx.stroke();
                
                // ç»˜åˆ¶ç®­å¤´
                drawArrow(650, 155, 645, 155);
                
                // ç»˜åˆ¶æ–‡æœ¬
                ctx.fillStyle = '#ff9800';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('è„é¡µåˆ·æ–°', 475, 150);
            }
            
            // ç»˜åˆ¶Redo Logåˆ°Buffer Poolçš„ç®­å¤´
            if (currentStep >= 1) {
                ctx.strokeStyle = '#4caf50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(350, 200); // Redo Logå·¦ä¾§
                ctx.lineTo(300, 200); // Buffer Poolå³ä¾§
                ctx.stroke();
                
                // ç»˜åˆ¶ç®­å¤´
                drawArrow(300, 200, 295, 200);
                
                // ç»˜åˆ¶æ–‡æœ¬
                ctx.fillStyle = '#4caf50';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Redoåº”ç”¨', 325, 195);
            }
        }

        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(x, y, prevX, prevY) {
            const angle = Math.atan2(y - prevY, x - prevX);
            const headLength = 10;
            
            ctx.fillStyle = ctx.strokeStyle;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(
                x - headLength * Math.cos(angle - Math.PI / 6),
                y - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                x - headLength * Math.cos(angle + Math.PI / 6),
                y - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fill();
        }

        // ç”Ÿæˆæ—¶é—´çº¿
        function generateTimeline() {
            const type = checkpointTypes[currentCheckpointType];
            checkpointTimeline.innerHTML = '';
            
            type.steps.forEach(step => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                if (step.id <= currentStep) {
                    timelineItem.classList.add('active');
                }
                timelineItem.innerHTML = `
                    <div>
                        <span class="timeline-step">${step.id}</span>
                        <span class="timeline-title">${step.title}</span>
                    </div>
                    <div class="timeline-description">${step.description}</div>
                `;
                checkpointTimeline.appendChild(timelineItem);
            });
        }

        // æ›´æ–°æŠ€æœ¯è¯¦æƒ…
        function updateTechnicalDetails() {
            const type = checkpointTypes[currentCheckpointType];
            
            technicalDetails.innerHTML = `
                <h3>${type.title}æŠ€æœ¯è¯¦æƒ…</h3>
                ${type.steps.map(step => `
                    <div class="detail-item">
                        <div class="detail-title">${step.id}. ${step.title}</div>
                        <div class="detail-description">${step.description}</div>
                    </div>
                `).join('')}
                <div class="detail-item">
                    <div class="detail-title">æŠ€æœ¯ç‰¹ç‚¹</div>
                    <div class="detail-description">${type.characteristics}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-title">é€‚ç”¨åœºæ™¯</div>
                    <div class="detail-description">${type.description}</div>
                </div>
            `;
        }

        // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
        function updatePerformanceMetrics() {
            let dirtyRatio = 75;
            let checkpointAgeVal = 45;
            let flushRateVal = 200;
            let redoUsage = 65;
            
            if (currentStep > 0) {
                switch(currentCheckpointType) {
                    case 'sharp':
                        dirtyRatio = Math.max(10, 75 - currentStep * 15);
                        checkpointAgeVal = Math.max(5, 45 - currentStep * 10);
                        flushRateVal = 500 + currentStep * 100;
                        redoUsage = Math.max(10, 65 - currentStep * 12);
                        break;
                    case 'fuzzy':
                        dirtyRatio = Math.max(30, 75 - currentStep * 10);
                        checkpointAgeVal = Math.max(20, 45 - currentStep * 5);
                        flushRateVal = 200 + currentStep * 50;
                        redoUsage = Math.max(30, 65 - currentStep * 8);
                        break;
                    case 'async':
                        dirtyRatio = 75 - currentStep * 8;
                        checkpointAgeVal = 45 - currentStep * 7;
                        flushRateVal = 300 + currentStep * 60;
                        redoUsage = Math.max(15, 65 - currentStep * 10);
                        break;
                    case 'sync':
                        dirtyRatio = Math.max(20, 75 - currentStep * 12);
                        checkpointAgeVal = 45 - currentStep * 8;
                        flushRateVal = 250 + currentStep * 70;
                        redoUsage = 65 - currentStep * 9;
                        break;
                }
            }
            
            dirtyPageRatio.textContent = `${Math.round(dirtyRatio)}%`;
            checkpointAge.textContent = `${Math.round(checkpointAgeVal)}%`;
            flushRate.innerHTML = `${Math.round(flushRateVal)}<span class="metric-unit">é¡µ/ç§’</span>`;
            redoLogUsage.textContent = `${Math.round(redoUsage)}%`;
        }

        // å¼€å§‹Checkpointæµç¨‹
        function startCheckpointFlow() {
            if (animationInterval) {
                clearInterval(animationInterval);
            }
            
            isRunning = true;
            currentStep = 0;
            drawCheckpointFlow();
            generateTimeline();
            updatePerformanceMetrics();
            
            animationInterval = setInterval(() => {
                currentStep++;
                if (currentStep > checkpointTypes[currentCheckpointType].steps.length) {
                    clearInterval(animationInterval);
                    isRunning = false;
                    return;
                }
                drawCheckpointFlow();
                generateTimeline();
                updatePerformanceMetrics();
            }, 1500);
        }

        // é‡ç½®Checkpointæµç¨‹
        function resetCheckpointFlow() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            isRunning = false;
            currentStep = 0;
            drawCheckpointFlow();
            generateTimeline();
            updatePerformanceMetrics();
        }

        // åˆ‡æ¢Checkpointç±»å‹
        function switchCheckpointType(type) {
            // æ›´æ–°å½“å‰ç±»å‹
            currentCheckpointType = type;
            
            // æ›´æ–°å¡ç‰‡é€‰ä¸­çŠ¶æ€
            typeCards.forEach(card => {
                if (card.dataset.type === type) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            // é‡ç½®æµç¨‹
            resetCheckpointFlow();
            
            // æ›´æ–°è¯¦æƒ…
            updateTechnicalDetails();
        }

        // åˆå§‹åŒ–
        function init() {
            // åˆå§‹åŒ–ç”»å¸ƒå¤§å°
            initCanvasSize();
            
            // åˆå§‹ç»˜åˆ¶
            drawCheckpointFlow();
            
            // ç”Ÿæˆæ—¶é—´çº¿
            generateTimeline();
            
            // åˆå§‹åŒ–æ€§èƒ½æŒ‡æ ‡
            updatePerformanceMetrics();
            
            // ç»‘å®šå¡ç‰‡ç‚¹å‡»äº‹ä»¶
            typeCards.forEach(card => {
                card.addEventListener('click', () => {
                    switchCheckpointType(card.dataset.type);
                });
            });
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            startCheckpointBtn.addEventListener('click', startCheckpointFlow);
            resetBtn.addEventListener('click', resetCheckpointFlow);
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒ
            window.addEventListener('resize', () => {
                initCanvasSize();
                drawCheckpointFlow();
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>