<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQLäº‹åŠ¡å¤„ç†æµç¨‹ï¼ˆå®Œæ•´ä¿®å¤ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
            padding: 30px;
            overflow: hidden;
        }
        
        h1 {
            color: #0d3c61;
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2a7de1;
            font-weight: 600;
            font-size: 32px;
        }
        
        .subtitle {
            text-align: center;
            color: #5d7186;
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 400;
        }
        
        .flowchart-wrapper {
            width: 100%;
            overflow: auto;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #f0f7ff 100%);
            padding: 20px;
            min-height: 850px;
            border: 1px solid #e1e8f0;
            position: relative;
        }
        
        svg {
            display: block;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        /* æµç¨‹èŠ‚ç‚¹æ ·å¼ */
        .process-node {
            stroke-width: 2;
            stroke: #2a7de1;
            rx: 8;
            ry: 8;
            filter: drop-shadow(0 3px 6px rgba(42, 125, 225, 0.1));
            transition: all 0.3s ease;
        }
        
        .process-node:hover {
            filter: drop-shadow(0 6px 12px rgba(42, 125, 225, 0.2));
            stroke-width: 3;
            cursor: pointer;
        }
        
        /* ç®­å¤´æ ·å¼ */
        .process-arrow {
            stroke-width: 2;
            stroke: #2a7de1;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .critical-arrow {
            stroke-width: 3;
            stroke: #fa8c16;
            fill: none;
            marker-end: url(#critical-arrow);
        }
        
        .rollback-arrow {
            stroke-width: 2;
            stroke: #f5222d;
            fill: none;
            stroke-dasharray: 5,5;
            marker-end: url(#rollback-arrow);
        }
        
        /* æ–‡æœ¬æ ·å¼ */
        .node-title {
            font-size: 15px;
            font-weight: 600;
            fill: #0d3c61;
            text-anchor: middle;
        }
        
        .node-desc {
            font-size: 13px;
            fill: #5d7186;
            text-anchor: middle;
        }
        
        .arrow-label {
            font-size: 13px;
            fill: #5d7186;
            font-weight: 500;
        }
        
        /* é˜¶æ®µæ ‡é¢˜ */
        .phase-header {
            font-size: 20px;
            font-weight: 700;
            fill: #0d3c61;
            text-anchor: middle;
            text-decoration: underline;
            text-decoration-color: #2a7de1;
            text-decoration-thickness: 3px;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 25px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #2a7de1 0%, #1e5cb3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(42, 125, 225, 0.2);
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, #1e5cb3 0%, #154280 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(42, 125, 225, 0.3);
        }
        
        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            border-radius: 12px;
            border-left: 5px solid #2a7de1;
        }
        
        .info-panel h3 {
            color: #0d3c61;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
        }
        
        .phase-section {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .phase-section h4 {
            color: #2a7de1;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .phase-section h4:before {
            content: "â–¶";
            margin-right: 10px;
            color: #2a7de1;
        }
        
        .phase-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .phase-section li {
            margin-bottom: 8px;
            line-height: 1.7;
        }
        
        .highlight {
            color: #2a7de1;
            font-weight: 600;
            background-color: rgba(42, 125, 225, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        /* é¢œè‰²å®šä¹‰ */
        .client-color { fill: #e6f7ff; }
        .server-color { fill: #f0f8ff; }
        .innodb-color { fill: #f6ffed; }
        .disk-color { fill: #fff7e6; }
        .commit-color { fill: #f6ffed; }
        .rollback-color { fill: #fff1f0; }
        
        /* æ—¶é—´çº¿ */
        .timeline {
            stroke: #91d5ff;
            stroke-width: 3;
            stroke-dasharray: 10,5;
        }
        
        @media (max-width: 1200px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .flowchart-wrapper {
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 16px;
            }
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .flowchart-wrapper::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        .flowchart-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        .flowchart-wrapper::-webkit-scrollbar-thumb {
            background: #2a7de1;
            border-radius: 5px;
        }
        
        .flowchart-wrapper::-webkit-scrollbar-thumb:hover {
            background: #1e5cb3;
        }
        
        /* å…³é”®èŠ‚ç‚¹é«˜äº® */
        .critical-node {
            stroke-width: 3;
            stroke: #fa8c16;
            filter: drop-shadow(0 4px 10px rgba(250, 140, 22, 0.3));
        }
        
        /* é˜¶æ®µåˆ†éš” */
        .phase-divider {
            stroke: #91d5ff;
            stroke-width: 2;
            stroke-dasharray: 15,10;
        }
        
        /* è¯´æ˜æ¡† */
        .info-box {
            fill: #e6f7ff;
            stroke: #91d5ff;
            stroke-width: 2;
            rx: 10;
            ry: 10;
            filter: drop-shadow(0 3px 8px rgba(145, 213, 255, 0.2));
        }
        
        .info-title {
            font-size: 16px;
            font-weight: 700;
            fill: #0d3c61;
            text-anchor: middle;
        }
        
        .info-text {
            font-size: 13px;
            fill: #5d7186;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MySQLäº‹åŠ¡å¤„ç†æµç¨‹ï¼ˆå®Œæ•´ä¿®å¤ç‰ˆï¼‰</h1>
        <p class="subtitle">æ¸…æ™°ã€å®Œæ•´çš„InnoDBäº‹åŠ¡å¤„ç†æœºåˆ¶å›¾ç¤º</p>
        
        <div class="flowchart-wrapper">
            <svg id="flowchart" width="1600" height="3000" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <!-- ç®­å¤´å®šä¹‰ -->
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#2a7de1"/>
                    </marker>
                    <marker id="critical-arrow" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                        <polygon points="0 0, 12 4.5, 0 9" fill="#fa8c16"/>
                    </marker>
                    <marker id="rollback-arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#f5222d"/>
                    </marker>
                    
                    <!-- æ¸å˜å®šä¹‰ -->
                    <linearGradient id="client-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e6f7ff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#bae7ff;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="server-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#f0f8ff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#d4eeff;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="innodb-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#f6ffed;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#d9f7be;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- æ—¶é—´è½´ -->
                <line x1="200" y1="100" x2="1400" y2="100" class="timeline"/>
                <text x="800" y="90" class="node-title" font-size="16">MySQLäº‹åŠ¡å¤„ç†æ—¶é—´çº¿</text>
                
                <!-- ==================== ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡å¼€å§‹ ==================== -->
                <text x="800" y="140" class="phase-header">ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡å¼€å§‹</text>
                
                <!-- æ­¥éª¤1: å®¢æˆ·ç«¯å‘é€BEGIN -->
                <rect x="300" y="160" width="400" height="80" class="process-node client-color"/>
                <text x="500" y="195" class="node-title">1. å®¢æˆ·ç«¯å‘é€BEGIN</text>
                <text x="500" y="215" class="node-desc">BEGIN / START TRANSACTION</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤2 -->
                <path d="M 500 240 L 500 280" class="process-arrow"/>
                <text x="520" y="260" class="arrow-label">å»ºç«‹è¿æ¥</text>
                
                <!-- æ­¥éª¤2: è¿æ¥å™¨éªŒè¯ -->
                <rect x="300" y="280" width="400" height="80" class="process-node server-color"/>
                <text x="500" y="315" class="node-title">2. è¿æ¥å™¨éªŒè¯</text>
                <text x="500" y="335" class="node-desc">éªŒè¯æƒé™ï¼Œåˆ†é…çº¿ç¨‹</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤3 -->
                <path d="M 500 360 L 500 400" class="process-arrow"/>
                <text x="520" y="380" class="arrow-label">åˆ†é…äº‹åŠ¡ID</text>
                
                <!-- æ­¥éª¤3: åˆ†é…äº‹åŠ¡ID -->
                <rect x="300" y="400" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="435" class="node-title">3. åˆ†é…äº‹åŠ¡ID</text>
                <text x="500" y="455" class="node-desc">trx_id = äº‹åŠ¡è®¡æ•°å™¨+1</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="500" x2="1500" y2="500" class="phase-divider"/>
                
                <!-- ==================== ç¬¬äºŒé˜¶æ®µï¼šSQLæ‰§è¡Œå‡†å¤‡ ==================== -->
                <text x="800" y="540" class="phase-header">ç¬¬äºŒé˜¶æ®µï¼šSQLæ‰§è¡Œå‡†å¤‡</text>
                
                <!-- æ­¥éª¤4: å®¢æˆ·ç«¯å‘é€SQL -->
                <rect x="300" y="560" width="400" height="80" class="process-node client-color"/>
                <text x="500" y="595" class="node-title">4. å®¢æˆ·ç«¯å‘é€SQL</text>
                <text x="500" y="615" class="node-desc">UPDATE users SET name='John'</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤5 -->
                <path d="M 500 640 L 500 680" class="process-arrow"/>
                <text x="520" y="660" class="arrow-label">SQLè¯·æ±‚</text>
                
                <!-- æ­¥éª¤5: Serverå±‚å¤„ç† -->
                <rect x="300" y="680" width="400" height="100" class="process-node server-color"/>
                <text x="500" y="715" class="node-title">5. Serverå±‚å¤„ç†</text>
                <text x="500" y="740" class="node-desc">è§£æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨</text>
                <text x="500" y="760" class="node-desc">ç”Ÿæˆæ‰§è¡Œè®¡åˆ’</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤6 -->
                <path d="M 500 780 L 500 820" class="process-arrow"/>
                <text x="520" y="800" class="arrow-label">è°ƒç”¨å¼•æ“API</text>
                
                <!-- æ­¥éª¤6: InnoDBå‡†å¤‡ -->
                <rect x="300" y="820" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="855" class="node-title">6. InnoDBå‡†å¤‡</text>
                <text x="500" y="875" class="node-desc">æ£€æŸ¥çº¦æŸï¼Œè·å–é”</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="920" x2="1500" y2="920" class="phase-divider"/>
                
                <!-- ==================== ç¬¬ä¸‰é˜¶æ®µï¼šUndo Logç”Ÿæˆ ==================== -->
                <text x="800" y="960" class="phase-header">ç¬¬ä¸‰é˜¶æ®µï¼šUndo Logç”Ÿæˆ (WALåŸåˆ™)</text>
                
                <!-- æ­¥éª¤7: ç”ŸæˆUndo Log -->
                <rect x="300" y="980" width="400" height="100" class="process-node innodb-color"/>
                <text x="500" y="1015" class="node-title">7. ç”ŸæˆUndo Log</text>
                <text x="500" y="1040" class="node-desc">è®°å½•ä¿®æ”¹å‰çš„æ•°æ®é•œåƒ</text>
                <text x="500" y="1060" class="node-desc">trx_id, roll_ptr, old_data</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤8 -->
                <path d="M 500 1080 L 500 1120" class="process-arrow"/>
                <text x="520" y="1100" class="arrow-label">å†™å…¥ç¼“å†²åŒº</text>
                
                <!-- æ­¥éª¤8: å†™å…¥Undo Logç¼“å†²åŒº -->
                <rect x="300" y="1120" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="1155" class="node-title">8. å†™å…¥Undo Logç¼“å†²åŒº</text>
                <text x="500" y="1175" class="node-desc">å†…å­˜ä¸­æš‚å­˜Undoè®°å½•</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="1220" x2="1500" y2="1220" class="phase-divider"/>
                
                <!-- ==================== ç¬¬å››é˜¶æ®µï¼šæ•°æ®ä¿®æ”¹ ==================== -->
                <text x="800" y="1260" class="phase-header">ç¬¬å››é˜¶æ®µï¼šæ•°æ®ä¿®æ”¹ (Buffer Poolæ“ä½œ)</text>
                
                <!-- æ­¥éª¤9: è¯»å–æ•°æ®é¡µåˆ°Buffer Pool -->
                <rect x="300" y="1280" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="1315" class="node-title">9. è¯»å–æ•°æ®é¡µåˆ°Buffer Pool</text>
                <text x="500" y="1335" class="node-desc">å¦‚æœªåœ¨å†…å­˜åˆ™ä»ç£ç›˜åŠ è½½</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤10 -->
                <path d="M 500 1360 L 500 1400" class="process-arrow"/>
                <text x="520" y="1380" class="arrow-label">ä¿®æ”¹æ•°æ®</text>
                
                <!-- æ­¥éª¤10: ä¿®æ”¹Buffer Poolæ•°æ®é¡µ -->
                <rect x="300" y="1400" width="400" height="100" class="process-node innodb-color"/>
                <text x="500" y="1435" class="node-title">10. ä¿®æ”¹Buffer Poolæ•°æ®é¡µ</text>
                <text x="500" y="1460" class="node-desc">æ›´æ–°å­—æ®µå€¼</text>
                <text x="500" y="1480" class="node-desc">æ ‡è®°ä¸ºè„é¡µ(Dirty Page)</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤11 -->
                <path d="M 500 1500 L 500 1540" class="process-arrow"/>
                <text x="520" y="1520" class="arrow-label">æ›´æ–°ç´¢å¼•</text>
                
                <!-- æ­¥éª¤11: æ›´æ–°ç›¸å…³ç´¢å¼• -->
                <rect x="300" y="1540" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="1575" class="node-title">11. æ›´æ–°ç›¸å…³ç´¢å¼•</text>
                <text x="500" y="1595" class="node-desc">å¦‚å­—æ®µæœ‰ç´¢å¼•åˆ™æ›´æ–°</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="1640" x2="1500" y2="1640" class="phase-divider"/>
                
                <!-- ==================== ç¬¬äº”é˜¶æ®µï¼šRedo Logç”Ÿæˆ ==================== -->
                <text x="800" y="1680" class="phase-header">ç¬¬äº”é˜¶æ®µï¼šRedo Logç”Ÿæˆ (ä¿è¯æŒä¹…æ€§)</text>
                
                <!-- æ­¥éª¤12: ç”ŸæˆRedo Log -->
                <rect x="300" y="1700" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="1735" class="node-title">12. ç”ŸæˆRedo Log</text>
                <text x="500" y="1755" class="node-desc">è®°å½•æ•°æ®ä¿®æ”¹æ“ä½œ</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤13 -->
                <path d="M 500 1780 L 500 1820" class="process-arrow"/>
                <text x="520" y="1800" class="arrow-label">å†™å…¥ç¼“å†²åŒº</text>
                
                <!-- æ­¥éª¤13: å†™å…¥Redo Logç¼“å†²åŒº -->
                <rect x="300" y="1820" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="1855" class="node-title">13. å†™å…¥Redo Logç¼“å†²åŒº</text>
                <text x="500" y="1875" class="node-desc">å†…å­˜ä¸­æš‚å­˜Redoè®°å½•</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="1920" x2="1500" y2="1920" class="phase-divider"/>
                
                <!-- ==================== ç¬¬å…­é˜¶æ®µï¼šäº‹åŠ¡æäº¤ ==================== -->
                <text x="800" y="1960" class="phase-header">ç¬¬å…­é˜¶æ®µï¼šäº‹åŠ¡æäº¤ (å…³é”®é˜¶æ®µ)</text>
                
                <!-- æ­¥éª¤14: å®¢æˆ·ç«¯å‘é€COMMIT -->
                <rect x="300" y="1980" width="400" height="80" class="process-node client-color"/>
                <text x="500" y="2015" class="node-title">14. å®¢æˆ·ç«¯å‘é€COMMIT</text>
                <text x="500" y="2035" class="node-desc">æäº¤äº‹åŠ¡è¯·æ±‚</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤15 -->
                <path d="M 500 2060 L 500 2100" class="process-arrow"/>
                <text x="520" y="2080" class="arrow-label">æäº¤äº‹åŠ¡</text>
                
                <!-- æ­¥éª¤15: Redo Logåˆ·ç›˜ (å…³é”®æ­¥éª¤) -->
                <rect x="300" y="2100" width="400" height="100" class="process-node critical-node innodb-color"/>
                <text x="500" y="2135" class="node-title" fill="#fa8c16">15. Redo Logåˆ·ç›˜ (å…³é”®æ­¥éª¤)</text>
                <text x="500" y="2160" class="node-desc" fill="#fa8c16">å°†Log Bufferåˆ·æ–°åˆ°ç£ç›˜</text>
                <text x="500" y="2180" class="node-desc" fill="#fa8c16">ä¿è¯äº‹åŠ¡æŒä¹…æ€§</text>
                
                <!-- å…³é”®è·¯å¾„æ ‡æ³¨ -->
                <path d="M 100 2150 Q 50 2150 50 2200 Q 50 2250 150 2250" class="critical-arrow"/>
                <text x="100" y="2220" class="arrow-label" fill="#fa8c16" font-weight="bold">å…³é”®è·¯å¾„</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤16 -->
                <path d="M 500 2200 L 500 2240" class="process-arrow"/>
                <text x="520" y="2220" class="arrow-label">é‡Šæ”¾é”</text>
                
                <!-- æ­¥éª¤16: é‡Šæ”¾é”èµ„æº -->
                <rect x="300" y="2240" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="2275" class="node-title">16. é‡Šæ”¾é”èµ„æº</text>
                <text x="500" y="2295" class="node-desc">è¡Œé”ã€è¡¨é”ç­‰</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="2340" x2="1500" y2="2340" class="phase-divider"/>
                
                <!-- ==================== ç¬¬ä¸ƒé˜¶æ®µï¼šå¼‚æ­¥åˆ·è„é¡µ ==================== -->
                <text x="800" y="2380" class="phase-header">ç¬¬ä¸ƒé˜¶æ®µï¼šå¼‚æ­¥åˆ·è„é¡µ (åå°æ“ä½œ)</text>
                
                <!-- æ­¥éª¤17: åå°çº¿ç¨‹åˆ·è„é¡µ -->
                <rect x="300" y="2400" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="2435" class="node-title">17. åå°çº¿ç¨‹åˆ·è„é¡µ</text>
                <text x="500" y="2455" class="node-desc">Page Cleanerçº¿ç¨‹</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤18 -->
                <path d="M 500 2480 L 500 2520" class="process-arrow"/>
                <text x="520" y="2500" class="arrow-label">å†™å…¥æ•°æ®æ–‡ä»¶</text>
                
                <!-- æ­¥éª¤18: æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ -->
                <rect x="300" y="2520" width="400" height="80" class="process-node disk-color"/>
                <text x="500" y="2555" class="node-title">18. æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶</text>
                <text x="500" y="2575" class="node-desc">.ibdæ•°æ®æ–‡ä»¶</text>
                
                <!-- é˜¶æ®µåˆ†éš”çº¿ -->
                <line x1="100" y1="2620" x2="1500" y2="2620" class="phase-divider"/>
                
                <!-- ==================== ç¬¬å…«é˜¶æ®µï¼šæ¸…ç†é˜¶æ®µ ==================== -->
                <text x="800" y="2660" class="phase-header">ç¬¬å…«é˜¶æ®µï¼šæ¸…ç†é˜¶æ®µ</text>
                
                <!-- æ­¥éª¤19: Purgeçº¿ç¨‹æ¸…ç†Undo Log -->
                <rect x="300" y="2680" width="400" height="80" class="process-node innodb-color"/>
                <text x="500" y="2715" class="node-title">19. Purgeçº¿ç¨‹æ¸…ç†Undo Log</text>
                <text x="500" y="2735" class="node-desc">å›æ”¶ä¸å†éœ€è¦çš„Undo</text>
                
                <!-- ç®­å¤´åˆ°æ­¥éª¤20 -->
                <path d="M 500 2760 L 500 2800" class="process-arrow"/>
                <text x="520" y="2780" class="arrow-label">è¿”å›ç»“æœ</text>
                
                <!-- æ­¥éª¤20: è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ -->
                <rect x="300" y="2800" width="400" height="80" class="process-node client-color"/>
                <text x="500" y="2835" class="node-title">20. è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</text>
                <text x="500" y="2855" class="node-desc">Query OK, 1 row affected</text>
                
                <!-- å®Œæˆæ ‡è®° -->
                <rect x="250" y="2900" width="500" height="60" class="process-node" fill="#52c41a"/>
                <text x="500" y="2935" class="node-title" fill="white">äº‹åŠ¡å¤„ç†å®Œæˆ âœ“</text>
                
                <!-- ==================== å³ä¾§ä¿¡æ¯é¢æ¿ ==================== -->
                <!-- WALåŸåˆ™è¯´æ˜ -->
                <rect x="1000" y="160" width="500" height="120" class="info-box"/>
                <text x="1250" y="185" class="info-title">WALåŸåˆ™</text>
                <text x="1250" y="210" class="info-text">Write-Ahead Logging</text>
                <text x="1250" y="230" class="info-text">å…ˆå†™æ—¥å¿—ï¼Œåæ”¹æ•°æ®</text>
                <text x="1250" y="250" class="info-text">ä¿è¯åŸå­æ€§å’ŒæŒä¹…æ€§</text>
                
                <!-- è¿æ¥è¯´æ˜ -->
                <path d="M 700 200 Q 800 200 900 200 Q 1000 200 1000 200" class="process-arrow" stroke-dasharray="5,5"/>
                
                <!-- äº‹åŠ¡å›æ»šè·¯å¾„ -->
                <rect x="1000" y="320" width="500" height="120" class="info-box"/>
                <text x="1250" y="345" class="info-title">äº‹åŠ¡å›æ»šæµç¨‹</text>
                <text x="1250" y="370" class="info-text">å¦‚æœæ‰§è¡ŒROLLBACKæˆ–å‘ç”Ÿé”™è¯¯</text>
                <text x="1250" y="390" class="info-text">ä½¿ç”¨Undo Logæ¢å¤æ•°æ®</text>
                <text x="1250" y="410" class="info-text">é‡Šæ”¾é”ï¼Œæ¸…ç†èµ„æº</text>
                
                <!-- å›æ»šç®­å¤´ -->
                <path d="M 700 360 Q 800 360 900 360 Q 1000 360 1000 360" class="rollback-arrow"/>
                
                <!-- ACIDç‰¹æ€§ -->
                <rect x="1000" y="480" width="500" height="180" class="info-box"/>
                <text x="1250" y="505" class="info-title">ACIDç‰¹æ€§å®ç°</text>
                <text x="1250" y="530" class="info-text">åŸå­æ€§ï¼šé€šè¿‡Undo Logå®ç°</text>
                <text x="1250" y="550" class="info-text">ä¸€è‡´æ€§ï¼šçº¦æŸæ£€æŸ¥+æ—¥å¿—ä¿è¯</text>
                <text x="1250" y="570" class="info-text">éš”ç¦»æ€§ï¼šé”æœºåˆ¶+MVCCå®ç°</text>
                <text x="1250" y="590" class="info-text">æŒä¹…æ€§ï¼šRedo Logåˆ·ç›˜ä¿è¯</text>
                
                <!-- MVCCè¯´æ˜ -->
                <rect x="1000" y="700" width="500" height="120" class="info-box"/>
                <text x="1250" y="725" class="info-title">MVCCä¸äº‹åŠ¡å…³ç³»</text>
                <text x="1250" y="750" class="info-text">éé”å®šè¯»ï¼šé€šè¿‡Undo Logè®¿é—®å†å²ç‰ˆæœ¬</text>
                <text x="1250" y="770" class="info-text">Read Viewï¼šå†³å®šæ•°æ®å¯è§æ€§</text>
                
                <!-- æ€§èƒ½ä¼˜åŒ– -->
                <rect x="1000" y="860" width="500" height="180" class="info-box"/>
                <text x="1250" y="885" class="info-title">æ€§èƒ½ä¼˜åŒ–è¦ç‚¹</text>
                <text x="1250" y="910" class="info-text">WALåŸåˆ™ï¼šé¡ºåºå†™æ—¥å¿—</text>
                <text x="1250" y="930" class="info-text">ç»„æäº¤ï¼šåˆå¹¶Redo Logåˆ·ç›˜</text>
                <text x="1250" y="950" class="info-text">å¼‚æ­¥åˆ·è„é¡µï¼šä¸å½±å“äº‹åŠ¡æäº¤</text>
                <text x="1250" y="970" class="info-text">Change Bufferï¼šå‡å°‘éšæœºI/O</text>
                
                <!-- å›¾ä¾‹è¯´æ˜ -->
                <rect x="1000" y="1080" width="500" height="180" class="info-box"/>
                <text x="1250" y="1105" class="info-title">å›¾ä¾‹è¯´æ˜</text>
                
                <rect x="1020" y="1130" width="30" height="30" class="process-node client-color"/>
                <text x="1060" y="1150" class="info-text">å®¢æˆ·ç«¯æ“ä½œ</text>
                
                <rect x="1150" y="1130" width="30" height="30" class="process-node server-color"/>
                <text x="1190" y="1150" class="info-text">Serverå±‚æ“ä½œ</text>
                
                <rect x="1020" y="1170" width="30" height="30" class="process-node innodb-color"/>
                <text x="1060" y="1190" class="info-text">InnoDBæ“ä½œ</text>
                
                <rect x="1150" y="1170" width="30" height="30" class="process-node disk-color"/>
                <text x="1190" y="1190" class="info-text">ç£ç›˜æ“ä½œ</text>
                
                <rect x="1020" y="1210" width="30" height="30" class="process-node critical-node"/>
                <text x="1060" y="1230" class="info-text">å…³é”®æ­¥éª¤</text>
                
                <line x1="1150" y1="1245" x2="1180" y2="1245" class="rollback-arrow"/>
                <text x="1190" y="1250" class="info-text">å›æ»šè·¯å¾„</text>
                
                <!-- æ—¶é—´è½´ -->
                <line x1="100" y1="2980" x2="1500" y2="2980" class="timeline"/>
                <text x="800" y="3000" class="node-title" font-size="14">MySQLäº‹åŠ¡å¤„ç†æ—¶é—´çº¿</text>
                
                <!-- æ€»ç®­å¤´ -->
                <path d="M 500 480 L 500 520" class="process-arrow"/>
                <path d="M 500 900 L 500 940" class="process-arrow"/>
                <path d="M 500 1200 L 500 1240" class="process-arrow"/>
                <path d="M 500 1600 L 500 1640" class="process-arrow"/>
                <path d="M 500 1880 L 500 1920" class="process-arrow"/>
                <path d="M 500 2320 L 500 2360" class="process-arrow"/>
                <path d="M 500 2600 L 500 2640" class="process-arrow"/>
                <path d="M 500 2880 L 500 2960" class="process-arrow"/>
            </svg>
        </div>
        
        <div class="controls">
            <button id="zoomIn" class="control-btn">æ”¾å¤§è§†å›¾</button>
            <button id="zoomOut" class="control-btn">ç¼©å°è§†å›¾</button>
            <button id="resetView" class="control-btn">é‡ç½®è§†å›¾</button>
            <button id="downloadSVG" class="control-btn">ä¸‹è½½SVGå›¾</button>
            <button id="toggleInfo" class="control-btn">åˆ‡æ¢ä¿¡æ¯é¢æ¿</button>
        </div>
        
        <div class="info-panel" id="infoPanel">
            <h3>MySQLäº‹åŠ¡å¤„ç†æµç¨‹è¯¦è§£</h3>
            
            <div class="phase-section">
                <h4>ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡å¼€å§‹</h4>
                <ul>
                    <li><span class="highlight">å®¢æˆ·ç«¯å‘é€BEGIN</span>ï¼šåº”ç”¨ç¨‹åºé€šè¿‡BEGINã€START TRANSACTIONæˆ–è®¾ç½®autocommit=0å¯åŠ¨äº‹åŠ¡ã€‚</li>
                    <li><span class="highlight">è¿æ¥å™¨éªŒè¯</span>ï¼šMySQLè¿æ¥å™¨éªŒè¯å®¢æˆ·ç«¯æƒé™ï¼Œä¸ºè¿æ¥åˆ†é…çº¿ç¨‹ï¼Œå»ºç«‹é€šä¿¡é€šé“ã€‚</li>
                    <li><span class="highlight">åˆ†é…äº‹åŠ¡ID</span>ï¼šInnoDBä¸ºæ–°äº‹åŠ¡åˆ†é…å”¯ä¸€çš„äº‹åŠ¡ID (trx_id)ï¼Œç”¨äºMVCCç‰ˆæœ¬æ§åˆ¶å’Œé”ç®¡ç†ã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬äºŒé˜¶æ®µï¼šSQLæ‰§è¡Œå‡†å¤‡</h4>
                <ul>
                    <li><span class="highlight">å®¢æˆ·ç«¯å‘é€SQL</span>ï¼šåº”ç”¨ç¨‹åºå‘é€UPDATEã€INSERTæˆ–DELETEç­‰DMLè¯­å¥åˆ°MySQLæœåŠ¡å™¨ã€‚</li>
                    <li><span class="highlight">Serverå±‚å¤„ç†</span>ï¼š
                        <ul>
                            <li><strong>è§£æå™¨</strong>ï¼šå¯¹SQLè¿›è¡Œè¯æ³•å’Œè¯­æ³•åˆ†æï¼Œç”Ÿæˆè§£ææ ‘ã€‚</li>
                            <li><strong>ä¼˜åŒ–å™¨</strong>ï¼šåŸºäºæˆæœ¬é€‰æ‹©æœ€ä¼˜æ‰§è¡Œè®¡åˆ’ï¼Œè€ƒè™‘ç´¢å¼•é€‰æ‹©ã€è¿æ¥é¡ºåºç­‰ã€‚</li>
                            <li><strong>æ‰§è¡Œå™¨</strong>ï¼šå‡†å¤‡è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£æ‰§è¡ŒæŸ¥è¯¢ã€‚</li>
                        </ul>
                    </li>
                    <li><span class="highlight">InnoDBå‡†å¤‡</span>ï¼šInnoDBæ£€æŸ¥ç›¸å…³çº¦æŸï¼ˆå¦‚å¤–é”®çº¦æŸï¼‰ï¼Œè·å–å¿…è¦çš„é”ï¼ˆè¡Œé”ã€æ„å‘é”ç­‰ï¼‰ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬ä¸‰é˜¶æ®µï¼šUndo Logç”Ÿæˆ (WALåŸåˆ™)</h4>
                <ul>
                    <li><span class="highlight">ç”ŸæˆUndo Log</span>ï¼šInnoDBéµå¾ªWAL(Write-Ahead Logging)åŸåˆ™ï¼Œå…ˆå†™æ—¥å¿—ï¼Œå†ä¿®æ”¹æ•°æ®ã€‚è®°å½•ä¿®æ”¹å‰çš„å®Œæ•´æ•°æ®é•œåƒã€‚</li>
                    <li><span class="highlight">Undo Logå†…å®¹</span>ï¼šåŒ…å«äº‹åŠ¡ID (trx_id)ã€å›æ»šæŒ‡é’ˆ(roll_ptr)ã€ä¿®æ”¹å‰çš„æ•°æ®å€¼(old_data)ç­‰ã€‚</li>
                    <li><span class="highlight">Undo Logä½œç”¨</span>ï¼šæ”¯æŒäº‹åŠ¡å›æ»šå’ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œä¸ºå…¶ä»–äº‹åŠ¡æä¾›å†å²ç‰ˆæœ¬æ•°æ®è®¿é—®ã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬å››é˜¶æ®µï¼šæ•°æ®ä¿®æ”¹ (Buffer Poolæ“ä½œ)</h4>
                <ul>
                    <li><span class="highlight">åŠ è½½æ•°æ®é¡µ</span>ï¼šå¦‚æœç›®æ ‡æ•°æ®é¡µä¸åœ¨Buffer Poolä¸­ï¼Œåˆ™ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜çš„Buffer Poolã€‚</li>
                    <li><span class="highlight">ä¿®æ”¹æ•°æ®é¡µ</span>ï¼šåœ¨Buffer Poolä¸­ä¿®æ”¹æ•°æ®ï¼Œæ›´æ–°ç›¸åº”çš„å­—æ®µå€¼ã€‚</li>
                    <li><span class="highlight">æ ‡è®°è„é¡µ</span>ï¼šä¿®æ”¹åçš„æ•°æ®é¡µè¢«æ ‡è®°ä¸º"è„é¡µ"(Dirty Page)ï¼Œè¡¨ç¤ºå†…å­˜ä¸­çš„æ•°æ®ä¸ç£ç›˜ä¸ä¸€è‡´ã€‚</li>
                    <li><span class="highlight">æ›´æ–°ç´¢å¼•</span>ï¼šå¦‚æœä¿®æ”¹çš„å­—æ®µæœ‰ç´¢å¼•ï¼Œéœ€è¦æ›´æ–°ç›¸åº”çš„ç´¢å¼•é¡µï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„ä¸€è‡´æ€§ã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬äº”é˜¶æ®µï¼šRedo Logç”Ÿæˆ (ä¿è¯æŒä¹…æ€§)</h4>
                <ul>
                    <li><span class="highlight">ç”ŸæˆRedo Log</span>ï¼šè®°å½•æ•°æ®ä¿®æ”¹æ“ä½œï¼ŒåŒ…æ‹¬ä¿®æ”¹çš„é¡µé¢ã€ä½ç½®ã€æ–°å€¼ç­‰ç‰©ç†æ—¥å¿—ä¿¡æ¯ã€‚</li>
                    <li><span class="highlight">å†™å…¥Log Buffer</span>ï¼šRedo Logå…ˆå†™å…¥å†…å­˜ä¸­çš„Log Bufferï¼Œæ‰¹é‡å†™å…¥æå‡æ€§èƒ½ã€‚</li>
                    <li><span class="highlight">Redo Logä½œç”¨</span>ï¼šä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§(Durability)ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œä¹Ÿèƒ½é€šè¿‡Redo Logæ¢å¤å·²æäº¤ä½†æœªåˆ·ç›˜çš„æ•°æ®ã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬å…­é˜¶æ®µï¼šäº‹åŠ¡æäº¤ (å…³é”®é˜¶æ®µ)</h4>
                <ul>
                    <li><span class="highlight">å®¢æˆ·ç«¯å‘é€COMMIT</span>ï¼šåº”ç”¨ç¨‹åºæäº¤äº‹åŠ¡ï¼Œè¯·æ±‚æŒä¹…åŒ–æ•°æ®ä¿®æ”¹ã€‚</li>
                    <li><span class="highlight">Redo Logåˆ·ç›˜ (å…³é”®æ­¥éª¤)</span>ï¼šInnoDBå°†Log Bufferä¸­çš„Redo Logåˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶(ib_logfile)ï¼Œè¿™æ˜¯ä¿è¯äº‹åŠ¡æŒä¹…æ€§çš„å…³é”®æ­¥éª¤ã€‚</li>
                    <li><span class="highlight">ä¸¤é˜¶æ®µæäº¤</span>ï¼šåœ¨å¼€å¯binlogçš„æƒ…å†µä¸‹ï¼ŒMySQLä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®ï¼Œä¿è¯Redo Logå’ŒBinlogçš„ä¸€è‡´æ€§ã€‚</li>
                    <li><span class="highlight">é‡Šæ”¾é”</span>ï¼šäº‹åŠ¡æäº¤åé‡Šæ”¾æŒæœ‰çš„æ‰€æœ‰é”ï¼ˆè¡Œé”ã€è¡¨é”ç­‰ï¼‰ï¼Œå…¶ä»–è¢«é˜»å¡çš„äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li>
                    <li><span class="highlight">å…³é”®ç‚¹</span>ï¼šäº‹åŠ¡åœ¨Redo Logåˆ·ç›˜åå³è§†ä¸ºå·²æäº¤ï¼Œå³ä½¿æ•°æ®é¡µå°šæœªåˆ·ç›˜åˆ°.ibdæ–‡ä»¶ï¼Œä¹Ÿèƒ½é€šè¿‡Redo Logåœ¨å´©æºƒæ¢å¤æ—¶é‡åšã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬ä¸ƒé˜¶æ®µï¼šå¼‚æ­¥åˆ·è„é¡µ (åå°æ“ä½œ)</h4>
                <ul>
                    <li><span class="highlight">Page Cleanerçº¿ç¨‹</span>ï¼šInnoDBåå°çº¿ç¨‹å®šæœŸå°†Buffer Poolä¸­çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚</li>
                    <li><span class="highlight">å†™å…¥æ•°æ®æ–‡ä»¶</span>ï¼šè„é¡µè¢«å†™å…¥.ibdæ•°æ®æ–‡ä»¶ï¼Œå®Œæˆæ•°æ®æŒä¹…åŒ–ã€‚</li>
                    <li><span class="highlight">æ€§èƒ½ä¼˜åŒ–</span>ï¼šå¼‚æ­¥åˆ·è„é¡µä¸å½±å“äº‹åŠ¡æäº¤æ€§èƒ½ï¼Œæå‡ç³»ç»Ÿæ•´ä½“ååé‡ï¼Œé€šè¿‡æ‰¹é‡å†™å…¥å‡å°‘I/Oæ“ä½œã€‚</li>
                </ul>
            </div>
            
            <div class="phase-section">
                <h4>ç¬¬å…«é˜¶æ®µï¼šæ¸…ç†é˜¶æ®µ</h4>
                <ul>
                    <li><span class="highlight">Purgeçº¿ç¨‹æ¸…ç†</span>ï¼šåå°Purgeçº¿ç¨‹æ¸…ç†ä¸å†éœ€è¦çš„Undo Logè®°å½•ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</li>
                    <li><span class="highlight">è¿”å›ç»“æœ</span>ï¼šå‘å®¢æˆ·ç«¯è¿”å›æ‰§è¡Œç»“æœï¼ˆå¦‚ï¼šQuery OK, 1 row affectedï¼‰ã€‚</li>
                    <li><span class="highlight">äº‹åŠ¡å®Œæˆ</span>ï¼šæ‰€æœ‰é˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡å¤„ç†å®Œæˆï¼Œç³»ç»Ÿèµ„æºå¾—åˆ°é‡Šæ”¾ã€‚</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const svg = document.getElementById('flowchart');
            const container = document.querySelector('.flowchart-wrapper');
            const infoPanel = document.getElementById('infoPanel');
            let scale = 1;
            const scaleStep = 0.1;
            
            // ç¼©æ”¾åŠŸèƒ½
            document.getElementById('zoomIn').addEventListener('click', function() {
                scale += scaleStep;
                svg.style.transform = `scale(${scale})`;
                svg.style.transformOrigin = 'top left';
                updateScrollPosition();
            });
            
            document.getElementById('zoomOut').addEventListener('click', function() {
                if (scale > scaleStep) {
                    scale -= scaleStep;
                    svg.style.transform = `scale(${scale})`;
                    svg.style.transformOrigin = 'top left';
                    updateScrollPosition();
                }
            });
            
            document.getElementById('resetView').addEventListener('click', function() {
                scale = 1;
                svg.style.transform = `scale(${scale})`;
                svg.style.transformOrigin = 'top left';
                container.scrollTop = 0;
                container.scrollLeft = 0;
            });
            
            // æ›´æ–°æ»šåŠ¨ä½ç½®ä»¥ä¿æŒä¸­å¿ƒ
            function updateScrollPosition() {
                const scrollLeft = (svg.clientWidth * scale - container.clientWidth) / 2;
                const scrollTop = (svg.clientHeight * scale - container.clientHeight) / 3;
                
                container.scrollLeft = Math.max(0, scrollLeft);
                container.scrollTop = Math.max(0, scrollTop);
            }
            
            // ä¸‹è½½SVGåŠŸèƒ½
            document.getElementById('downloadSVG').addEventListener('click', function() {
                const serializer = new XMLSerializer();
                let source = serializer.serializeToString(svg);
                
                // æ·»åŠ å‘½åç©ºé—´
                if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
                    source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
                }
                if (!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
                    source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
                }
                
                const svgBlob = new Blob([source], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(svgBlob);
                
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = 'mysql-transaction-process-complete.svg';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(url);
            });
            
            // åˆ‡æ¢ä¿¡æ¯é¢æ¿
            document.getElementById('toggleInfo').addEventListener('click', function() {
                if (infoPanel.style.display === 'none') {
                    infoPanel.style.display = 'block';
                    this.textContent = 'éšè—ä¿¡æ¯é¢æ¿';
                } else {
                    infoPanel.style.display = 'none';
                    this.textContent = 'æ˜¾ç¤ºä¿¡æ¯é¢æ¿';
                }
            });
            
            // æ·»åŠ SVGäº¤äº’æ•ˆæœ
            const processNodes = document.querySelectorAll('.process-node');
            processNodes.forEach(node => {
                // æ‚¬åœæ•ˆæœ
                node.addEventListener('mouseenter', function() {
                    this.style.filter = 'drop-shadow(0 6px 12px rgba(42, 125, 225, 0.25))';
                    this.style.strokeWidth = '3';
                    
                    // è·å–èŠ‚ç‚¹æ–‡æœ¬
                    const textElements = this.parentNode.querySelectorAll('text');
                    let title = '';
                    textElements.forEach(text => {
                        if (text.classList.contains('node-title') && 
                            Math.abs(parseInt(text.getAttribute('x')) - 500) < 10) {
                            title = text.textContent;
                        }
                    });
                    
                    // æ·»åŠ æç¤ºæ•ˆæœ
                    if (title) {
                        this.setAttribute('data-original-fill', this.getAttribute('fill'));
                        this.setAttribute('fill', '#e6f7ff');
                    }
                });
                
                node.addEventListener('mouseleave', function() {
                    this.style.filter = 'drop-shadow(0 3px 6px rgba(42, 125, 225, 0.1))';
                    this.style.strokeWidth = '2';
                    
                    // æ¢å¤åŸå§‹é¢œè‰²
                    const originalFill = this.getAttribute('data-original-fill');
                    if (originalFill) {
                        this.setAttribute('fill', originalFill);
                    }
                });
                
                // ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                node.addEventListener('click', function() {
                    const textElements = this.parentNode.querySelectorAll('text');
                    let title = '', desc = '';
                    textElements.forEach(text => {
                        if (text.classList.contains('node-title') && 
                            Math.abs(parseInt(text.getAttribute('x')) - 500) < 10) {
                            title = text.textContent;
                        } else if (text.classList.contains('node-desc') && !desc && 
                                   Math.abs(parseInt(text.getAttribute('x')) - 500) < 10) {
                            desc = text.textContent;
                        }
                    });
                    
                    if (title) {
                        const stepNum = title.match(/^\d+/);
                        const phaseTitle = getPhaseTitle(stepNum ? parseInt(stepNum[0]) : 0);
                        
                        alert(`ğŸ“‹ ${title}\n\nğŸ“ ${desc || 'è¯¦ç»†ä¿¡æ¯'}\n\nğŸ·ï¸ æ‰€å±é˜¶æ®µ: ${phaseTitle}`);
                    }
                });
            });
            
            // è·å–é˜¶æ®µæ ‡é¢˜
            function getPhaseTitle(stepNum) {
                if (stepNum <= 3) return "ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡å¼€å§‹";
                if (stepNum <= 6) return "ç¬¬äºŒé˜¶æ®µï¼šSQLæ‰§è¡Œå‡†å¤‡";
                if (stepNum <= 8) return "ç¬¬ä¸‰é˜¶æ®µï¼šUndo Logç”Ÿæˆ";
                if (stepNum <= 11) return "ç¬¬å››é˜¶æ®µï¼šæ•°æ®ä¿®æ”¹";
                if (stepNum <= 13) return "ç¬¬äº”é˜¶æ®µï¼šRedo Logç”Ÿæˆ";
                if (stepNum <= 16) return "ç¬¬å…­é˜¶æ®µï¼šäº‹åŠ¡æäº¤";
                if (stepNum <= 18) return "ç¬¬ä¸ƒé˜¶æ®µï¼šå¼‚æ­¥åˆ·è„é¡µ";
                return "ç¬¬å…«é˜¶æ®µï¼šæ¸…ç†é˜¶æ®µ";
            }
            
            // è‡ªåŠ¨è°ƒæ•´è§†å›¾
            setTimeout(() => {
                updateScrollPosition();
            }, 200);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    if (e.key === '+' || e.key === '=') {
                        e.preventDefault();
                        document.getElementById('zoomIn').click();
                    } else if (e.key === '-') {
                        e.preventDefault();
                        document.getElementById('zoomOut').click();
                    } else if (e.key === '0') {
                        e.preventDefault();
                        document.getElementById('resetView').click();
                    } else if (e.key === 's' || e.key === 'S') {
                        e.preventDefault();
                        document.getElementById('downloadSVG').click();
                    } else if (e.key === 'i' || e.key === 'I') {
                        e.preventDefault();
                        document.getElementById('toggleInfo').click();
                    }
                }
            });
            
            // é˜¶æ®µæ ‡é¢˜äº¤äº’
            const phaseHeaders = document.querySelectorAll('.phase-header');
            phaseHeaders.forEach(header => {
                header.addEventListener('mouseenter', function() {
                    this.style.fill = '#2a7de1';
                    this.style.cursor = 'pointer';
                });
                
                header.addEventListener('mouseleave', function() {
                    this.style.fill = '#0d3c61';
                });
                
                header.addEventListener('click', function() {
                    const phaseText = this.textContent;
                    alert(`ğŸ“– ${phaseText}\n\nç‚¹å‡»æŸ¥çœ‹è¯¥é˜¶æ®µçš„è¯¦ç»†è¯´æ˜ã€‚`);
                });
            });
            
            // ä¿¡æ¯æ¡†äº¤äº’
            const infoBoxes = document.querySelectorAll('.info-box');
            infoBoxes.forEach(box => {
                box.addEventListener('mouseenter', function() {
                    this.style.filter = 'drop-shadow(0 6px 15px rgba(145, 213, 255, 0.3))';
                    this.style.strokeWidth = '3';
                });
                
                box.addEventListener('mouseleave', function() {
                    this.style.filter = 'drop-shadow(0 3px 8px rgba(145, 213, 255, 0.2))';
                    this.style.strokeWidth = '2';
                });
            });
        });
    </script>
</body>
</html>