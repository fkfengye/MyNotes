<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内存管理架构分层模型图</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a5298);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(90deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .architecture {
            display: flex;
            flex-direction: column;
            padding: 30px;
        }
        .layer {
            display: flex;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .layer:hover {
            transform: translateY(-5px);
        }
        .layer-header {
            flex: 0 0 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        .layer-content {
            flex: 1;
            padding: 25px;
            background: white;
        }
        .layer-content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }
        .layer-1 .layer-header { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .layer-1 .layer-content h3 { border-color: #e74c3c; }
        .layer-2 .layer-header { background: linear-gradient(135deg, #e67e22, #d35400); }
        .layer-2 .layer-content h3 { border-color: #e67e22; }
        .layer-3 .layer-header { background: linear-gradient(135deg, #3498db, #2980b9); }
        .layer-3 .layer-content h3 { border-color: #3498db; }
        .layer-4 .layer-header { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .layer-4 .layer-content h3 { border-color: #2ecc71; }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .component {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .layer-1 .component { border-color: #e74c3c; }
        .layer-2 .component { border-color: #e67e22; }
        .layer-3 .component { border-color: #3498db; }
        .layer-4 .component { border-color: #2ecc71; }
        .component h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .component ul {
            padding-left: 20px;
        }
        .component li {
            margin-bottom: 8px;
        }
        .flow-diagram {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        .flow-diagram h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .flow-steps {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .flow-step {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .step-number {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }
        .step-content {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        .step-arrow {
            text-align: center;
            font-size: 24px;
            color: #7f8c8d;
            margin: 10px 0;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #3498db;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .layer {
                flex-direction: column;
            }
            .layer-header {
                flex: 0 0 auto;
            }
            .component-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>内存管理架构分层模型图</h1>
            <p class="subtitle">从物理硬件到应用层的分层解耦架构</p>
        </header>

        <div class="architecture">
            <!-- 应用层 -->
            <div class="layer layer-4">
                <div class="layer-header">
                    <h2>应用层</h2>
                    <p>内存的"使用者"与业务优化</p>
                </div>
                <div class="layer-content">
                    <h3>核心职责：基于上层提供的内存抽象，高效使用内存</h3>
                    <div class="component-grid">
                        <div class="component">
                            <h4>内存使用方式</h4>
                            <ul>
                                <li>通过编程语言API创建数据</li>
                                <li>栈内存：编译器自动管理</li>
                                <li>堆内存：手动释放或依赖GC</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>应用层优化方向</h4>
                            <ul>
                                <li>减少内存碎片：对象池复用</li>
                                <li>控制内存占用：及时释放无用引用</li>
                                <li>缓存合理使用：存储热点数据</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-block">
// Java应用创建对象示例
User user = new User();  // 应用层发起对象创建请求
user.setName("张三");    // 应用层使用内存存储数据
                    </div>
                </div>
            </div>

            <!-- 运行时环境层 -->
            <div class="layer layer-3">
                <div class="layer-header">
                    <h2>运行时环境层</h2>
                    <p>应用内存的"优化器"与自动化管理</p>
                </div>
                <div class="layer-content">
                    <h3>核心职责：对OS提供的虚拟内存进行上层封装，简化应用的内存使用</h3>
                    <div class="component-grid">
                        <div class="component">
                            <h4>Java JVM</h4>
                            <ul>
                                <li>自动垃圾回收(GC)</li>
                                <li>内存划分为堆、栈、方法区</li>
                                <li>可达性分析识别无用对象</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>C/C++运行时库</h4>
                            <ul>
                                <li>手动内存管理辅助</li>
                                <li>内存池优化减少系统调用</li>
                                <li>malloc/free封装</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>浏览器JS引擎(V8)</h4>
                            <ul>
                                <li>新生代/老生代内存划分</li>
                                <li>隐藏类优化对象属性访问</li>
                                <li>垃圾回收+内存限制</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-block">
// JVM内存管理示例
// 1. 检查堆内存是否有空闲空间
// 2. 若无则触发GC回收无用对象
// 3. 若仍不足，通过mmap系统调用向OS申请虚拟内存
// 4. 扩展堆空间完成对象分配
                    </div>
                </div>
            </div>

            <!-- 操作系统内核层 -->
            <div class="layer layer-2">
                <div class="layer-header">
                    <h2>操作系统内核层</h2>
                    <p>物理内存的"管理者"与抽象封装</p>
                </div>
                <div class="layer-content">
                    <h3>核心职责：管理物理内存资源，通过虚拟内存技术为上层提供抽象</h3>
                    <div class="component-grid">
                        <div class="component">
                            <h4>物理内存管理</h4>
                            <ul>
                                <li>页帧(Page Frame)管理</li>
                                <li>伙伴系统(Buddy System)</li>
                                <li>SLUB/SLAB分配器</li>
                                <li>内存映射(MMIO)</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>虚拟内存管理</h4>
                            <ul>
                                <li>MMU(内存管理单元)</li>
                                <li>页表(多级页表)</li>
                                <li>页面置换(Page Replacement)</li>
                                <li>缺页异常处理</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>内核/用户空间隔离</h4>
                            <ul>
                                <li>内核空间：高地址区域</li>
                                <li>用户空间：低地址区域</li>
                                <li>系统调用桥梁</li>
                                <li>安全隔离机制</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-block">
// 操作系统处理mmap请求
// 1. 分配连续虚拟地址区域
// 2. 建立页表(初始无物理页帧映射)
// 3. 返回虚拟地址给JVM
// 4. 处理缺页异常，分配物理页帧
                    </div>
                </div>
            </div>

            <!-- 物理硬件层 -->
            <div class="layer layer-1">
                <div class="layer-header">
                    <h2>物理硬件层</h2>
                    <p>内存的"物理载体"与硬件控制</p>
                </div>
                <div class="layer-content">
                    <h3>核心职责：提供物理内存空间并响应上层的访问请求</h3>
                    <div class="component-grid">
                        <div class="component">
                            <h4>DRAM芯片</h4>
                            <ul>
                                <li>存储二进制数据的物理介质</li>
                                <li>存储单元(Cell)为最小单位</li>
                                <li>实际内存的"实体"</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>内存控制器</h4>
                            <ul>
                                <li>连接CPU与DRAM的桥梁</li>
                                <li>解析CPU的内存访问指令</li>
                                <li>控制DRAM读写时序</li>
                            </ul>
                        </div>
                        <div class="component">
                            <h4>地址/数据总线</h4>
                            <ul>
                                <li>地址总线：传递物理内存地址</li>
                                <li>数据总线：传递读写数据</li>
                                <li>64位总线支持最大16EB内存</li>
                            </ul>
                        </div>
                    </div>
                    <div class="code-block">
// 硬件层操作示例
// 1. CPU发起内存访问请求
// 2. 内存控制器解析指令
// 3. 控制DRAM读写时序
// 4. 数据通过总线传输
// 5. 内存控制器返回数据给CPU
                    </div>
                </div>
            </div>
        </div>

        <!-- 交互流程 -->
        <div class="flow-diagram">
            <h2>各层交互流程：Java应用创建对象示例</h2>
            <div class="flow-steps">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>应用层发起请求</h4>
                        <p>Java代码执行 <span class="highlight">User user = new User()</span>，发起对象创建请求</p>
                    </div>
                </div>
                <div class="step-arrow">↓</div>
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>运行时层(JVM)处理</h4>
                        <p>JVM检查堆内存空间 → 触发GC回收 → 通过 <span class="highlight">mmap系统调用</span> 向OS申请虚拟内存</p>
                    </div>
                </div>
                <div class="step-arrow">↓</div>
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>OS内核层响应</h4>
                        <p>OS分配虚拟地址区域 → 建立页表 → 返回虚拟地址给JVM → 处理 <span class="highlight">缺页异常</span> → 分配物理页帧</p>
                    </div>
                </div>
                <div class="step-arrow">↓</div>
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>物理硬件层执行</h4>
                        <p>内存控制器解析指令 → 控制DRAM读写时序 → 数据通过总线传输 → 完成对象创建</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 架构价值总结 -->
        <div class="layer-content" style="margin: 30px 0; padding: 25px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px;">
                分层架构的核心价值
            </h3>
            <div class="component-grid">
                <div class="component">
                    <h4>职责分离</h4>
                    <ul>
                        <li>硬件层：物理内存的硬件控制</li>
                        <li>OS层：物理内存分配与虚拟抽象</li>
                        <li>运行时层：自动化管理与性能优化</li>
                        <li>应用层：业务数据使用</li>
                    </ul>
                </div>
                <div class="component">
                    <h4>标准化接口</h4>
                    <ul>
                        <li>OS系统调用</li>
                        <li>运行时语言API</li>
                        <li>上层不依赖下层实现细节</li>
                        <li>降低开发复杂度</li>
                    </ul>
                </div>
                <div class="component">
                    <h4>安全与高效</h4>
                    <ul>
                        <li>进程隔离保证安全性</li>
                        <li>虚拟内存实现高效复用</li>
                        <li>自动化管理减少人为错误</li>
                        <li>性能优化专业化</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>内存管理架构分层模型 | 从物理硬件到应用层的完整体系</p>
            <p>分层解耦 · 职责分离 · 高效安全</p>
        </footer>
    </div>

    <script>
        // 添加交互效果
        document.addEventListener('DOMContentLoaded', function() {
            const layers = document.querySelectorAll('.layer');
            
            layers.forEach(layer => {
                layer.addEventListener('click', function() {
                    // 切换激活状态
                    layers.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示详细信息
                    const layerType = this.classList[1];
                    showLayerDetails(layerType);
                });
            });
            
            function showLayerDetails(layerType) {
                const details = {
                    'layer-1': {
                        title: '物理硬件层详情',
                        content: '物理硬件层是内存管理的最底层，由DRAM芯片、内存控制器和地址/数据总线组成。这一层仅识别物理地址，不理解进程或虚拟地址等上层概念。物理内存是所有进程和设备的共享资源，需要操作系统统一管理以避免冲突。'
                    },
                    'layer-2': {
                        title: '操作系统内核层详情',
                        content: '操作系统内核层是内存管理的核心，负责物理内存的分配和虚拟内存的抽象。通过伙伴系统管理连续内存，通过页表和MMU实现虚拟地址到物理地址的转换，通过内核/用户空间隔离保证系统安全。'
                    },
                    'layer-3': {
                        title: '运行时环境层详情',
                        content: '运行时环境层对操作系统提供的内存接口进行封装，提供自动内存管理功能。不同语言的运行时采用不同的策略：JVM使用垃圾回收，C/C++运行时使用内存池优化，JS引擎使用分代GC和隐藏类优化。'
                    },
                    'layer-4': {
                        title: '应用层详情',
                        content: '应用层是内存的最终使用者，专注于业务数据的存储和访问。应用开发者无需关心底层内存管理细节，只需通过编程语言API使用内存，并实施应用级优化如对象池、缓存等。'
                    }
                };
                
                const detail = details[layerType];
                if (detail) {
                    // 在实际应用中，这里可以显示模态框或更新页面内容
                    console.log(`${detail.title}: ${detail.content}`);
                }
            }
            
            // 添加悬停效果
            layers.forEach(layer => {
                layer.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-10px)';
                    this.style.boxShadow = '0 15px 25px rgba(0, 0, 0, 0.15)';
                });
                
                layer.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
                });
            });
        });
    </script>
</body>
</html>